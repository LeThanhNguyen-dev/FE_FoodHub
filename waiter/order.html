<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qu·∫£n l√Ω ƒë∆°n h√†ng</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="css/order-style.css" rel="stylesheet">
</head>

<body>
  <!-- Orders Management Template -->
  <template id="ordersPageTemplate">
    <div class="orders-container">
      <!-- Enhanced Header Section -->
      <!-- Filter and Sort Section -->
      <div class="orders-filter-section card mb-3">
        <div class="card-body">
          <div class="row g-3">
            <!-- Status Filter -->
            <div class="col-md-3">
              <label class="form-label">
                <i class="fas fa-filter me-1"></i>
                Tr·∫°ng th√°i
              </label>
              <select class="form-select" id="orderStatusFilter" onchange="applyOrderFilters()">
                <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                <option value="PENDING">Ch·ªù x·ª≠ l√Ω</option>
                <option value="CONFIRMED">ƒê√£ x√°c nh·∫≠n</option>
                <option value="READY">S·∫µn s√†ng</option>
                <option value="COMPLETED">Ho√†n th√†nh</option>
                <option value="CANCELLED">ƒê√£ h·ªßy</option>
              </select>
            </div>

            <!-- Table Filter -->
            <div class="col-md-3">
              <label class="form-label">
                <i class="fas fa-chair me-1"></i>
                B√†n
              </label>
              <input type="text" class="form-control" id="tableNumberFilter" placeholder="Ch·ªçn b√†n"
                onchange="applyOrderFilters()">
            </div>

            <!-- Min Price Filter -->
            <div class="col-md-3">
              <label class="form-label">
                <i class="fas fa-money-bill me-1"></i>
                Gi√° t·ªëi thi·ªÉu (VNƒê)
              </label>
              <input type="number" class="form-control" id="minPriceFilter" placeholder="0"
                onchange="applyOrderFilters()">
            </div>

            <!-- Max Price Filter -->
            <div class="col-md-3">
              <label class="form-label">
                <i class="fas fa-money-bill me-1"></i>
                Gi√° t·ªëi ƒëa (VNƒê)
              </label>
              <input type="number" class="form-control" id="maxPriceFilter" placeholder="1000000"
                onchange="applyOrderFilters()">
            </div>

            <!-- Sort Field -->
            <div class="col-md-4">
              <label class="form-label">
                <i class="fas fa-sort me-1"></i>
                S·∫Øp x·∫øp theo
              </label>
              <select class="form-select" id="sortByOrderFilter" onchange="applyOrderFilters()">
                <option value="createdAt">Th·ªùi gian t·∫°o</option>
                <option value="totalAmount">T·ªïng ti·ªÅn</option>
                <option value="id">M√£ ƒë∆°n h√†ng</option>
                <option value="status">Tr·∫°ng th√°i</option>
              </select>
            </div>

            <!-- Sort Direction -->
            <div class="col-md-4">
              <label class="form-label">
                <i class="fas fa-sort-amount-down me-1"></i>
                Th·ª© t·ª±
              </label>
              <select class="form-select" id="sortDirectionOrderFilter" onchange="applyOrderFilters()">
                <option value="DESC">Gi·∫£m d·∫ßn</option>
                <option value="ASC">TƒÉng d·∫ßn</option>
              </select>
            </div>

            <!-- Page Size -->
            <div class="col-md-4">
              <label class="form-label">
                <i class="fas fa-list me-1"></i>
                S·ªë ƒë∆°n/trang
              </label>
              <select class="form-select" id="pageSizeOrderFilter" onchange="applyOrderFilters()">
                <option value="5">5 ƒë∆°n</option>
                <option value="10" selected>10 ƒë∆°n</option>
                <option value="20">20 ƒë∆°n</option>
                <option value="50">50 ƒë∆°n</option>
              </select>
            </div>
          </div>

          <!-- Filter Actions -->
          <div class="row mt-3">
            <div class="col-12">
              <div class="d-flex gap-2 justify-content-between flex-wrap">
                <!-- Action Buttons (moved from header) -->
                <div class="d-flex gap-2">
                  <button class="btn btn-success" onclick="showMenu()">
                    <i class="fas fa-plus me-1"></i>
                    Nh·∫≠n ƒë∆°n m·ªõi
                  </button>
                  <button class="btn btn-outline-primary" onclick="refreshOrders()">
                    <i class="fas fa-sync-alt me-1"></i>
                    L√†m m·ªõi
                  </button>
                </div>

                <!-- Filter Buttons -->
                <div class="d-flex gap-2">
                  <button class="btn btn-outline-secondary" onclick="clearFilters()">
                    <i class="fas fa-times me-1"></i>
                    X√≥a b·ªô l·ªçc
                  </button>
                  <button class="btn btn-primary" onclick="applyOrderFilters()">
                    <i class="fas fa-search me-1"></i>
                    √Åp d·ª•ng
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Results Summary -->
      <div class="orders-summary mb-3">
        <div class="alert alert-info d-flex align-items-center">
          <i class="fas fa-info-circle me-2"></i>
          <span id="ordersSummary">ƒêang t·∫£i...</span>
        </div>
      </div>

      <!-- Enhanced Orders Table -->
      <div class="orders-table-card card">
        <div class="card-body">
          <div class="orders-table-wrapper">
            <table class="orders-table table">
              <thead>
                <tr>
                  <th><i class="fas fa-hashtag me-2"></i>M√£ ƒë∆°n</th>
                  <th><i class="fas fa-chair me-2"></i>B√†n</th>
                  <th><i class="fas fa-clock me-2"></i>Th·ªùi gian</th>
                  <th><i class="fas fa-money-bill me-2"></i>T·ªïng ti·ªÅn</th>
                  <th><i class="fas fa-info-circle me-2"></i>Tr·∫°ng th√°i</th>
                  <th><i class="fas fa-utensils me-2"></i>Lo·∫°i</th>
                  <th><i class="fas fa-cogs me-2"></i>H√†nh ƒë·ªông</th>
                </tr>
              </thead>
              <tbody id="orderTableBody">
                <!-- Loading state -->
                <tr>
                  <td colspan="7">
                    <div class="orders-loading">
                      <div class="spinner"></div>
                      <p>ƒêang t·∫£i danh s√°ch ƒë∆°n h√†ng...</p>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Enhanced Pagination -->
      <div class="pagination-container mt-3">
        <div class="d-flex justify-content-center">
          <div class="pagination-controls">
            <nav aria-label="Ph√¢n trang ƒë∆°n h√†ng">
              <ul class="pagination mb-0" id="paginationList">
                <!-- Pagination buttons will be generated here -->
              </ul>
            </nav>
          </div>
        </div>

        <!-- Quick Jump (only show when total pages > 10) -->
        <div class="pagination-jump mt-2" id="paginationJump" style="display: none;">
          <div class="d-flex justify-content-center align-items-center gap-2">
            <button class="btn btn-sm btn-outline-primary" onclick="jumpToOrderPage()">
              <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </template>

  <!-- Loading State Template -->
  <template id="loadingTemplate">
    <tr>
      <td colspan="7">
        <div class="orders-loading">
          <div class="spinner"></div>
          <p>ƒêang t·∫£i danh s√°ch ƒë∆°n h√†ng...</p>
        </div>
      </td>
    </tr>
  </template>

  <!-- Empty State Template -->
  <template id="emptyStateTemplate">
    <tr>
      <td colspan="7">
        <div class="empty-orders-state">
          <i class="fas fa-clipboard-list"></i>
          <h4>Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng n√†o</h4>
          <p>Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ƒë·ªÉ xem th√™m k·∫øt qu·∫£.</p>
          <button class="btn-orders-action btn-outline-secondary" onclick="clearFilters()">
            <i class="fas fa-times me-2"></i>X√≥a b·ªô l·ªçc
          </button>
        </div>
      </td>
    </tr>
  </template>

  <!-- Error State Template -->
  <template id="errorStateTemplate">
    <tr>
      <td colspan="7">
        <div class="empty-orders-state">
          <i class="fas fa-exclamation-triangle" style="color: var(--bs-danger);"></i>
          <h4 style="color: var(--bs-danger);">Kh√¥ng th·ªÉ t·∫£i danh s√°ch ƒë∆°n h√†ng</h4>
          <p id="errorMessage">C√≥ l·ªói x·∫£y ra khi t·∫£i d·ªØ li·ªáu</p>
          <button class="btn-orders-action btn-outline-primary" onclick="refreshOrders()">
            <i class="fas fa-sync-alt me-2"></i>Th·ª≠ l·∫°i
          </button>
        </div>
      </td>
    </tr>
  </template>

  <!-- Order Row Template -->
  <template id="orderRowTemplate">
    <tr class="order-row" onclick="viewOrderDetails({orderId})">
      <td>
        <strong>#{orderId}</strong>
      </td>
      <td>
        <span class="table-number-badge">
          <i class="fas fa-chair me-1"></i>
          {tableInfo}
        </span>
      </td>
      <td>
        <div class="order-time">
          <i class="fas fa-clock"></i>
          {formattedTime}
        </div>
      </td>
      <td>
        <div class="order-amount">
          <i class="fas fa-money-bill"></i>
          {formattedAmount}
        </div>
      </td>
      <td>
        <span class="status-badge-enhanced {statusClass}">
          {statusIcon}
          {statusText}
        </span>
      </td>
      <td>
        <span class="order-type-badge {orderTypeClass}">
          {orderTypeIcon}
          {orderTypeText}
        </span>
      </td>
      <td>
        <div class="action-btn-group">
          <button class="action-btn btn-info" onclick="event.stopPropagation(); viewOrderDetails({orderId})"
            title="Xem chi ti·∫øt">
            <i class="fas fa-eye"></i>
          </button>
        </div>
      </td>
    </tr>
  </template>

  <!-- Order Details Modal Template -->
  <template id="orderDetailsModalTemplate">
    <div class="modal-overlay" onclick="closeOrderDetails()">
      <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
          <h3>Chi ti·∫øt ƒë∆°n h√†ng #${id}</h3>
          <button class="btn-close" onclick="closeOrderDetails()">√ó</button>
        </div>

        <div class="modal-body">
          <div class="order-summary">
            <div class="info-row">
              <span>Tr·∫°ng th√°i:</span>
              <span class="badge ${getStatusBadgeClass(status)}">${getStatusText(status)}</span>
            </div>
            <div class="info-row">
              <span>Lo·∫°i ƒë∆°n:</span>
              <span>${getOrderTypeText(orderType)}</span>
            </div>
            <div class="info-row">
              <span>Th·ªùi gian t·∫°o:</span>
              <span>${formattedDateCreation}</span>
            </div>
            <div class="info-row">
              <span>Th·ªùi gian c·∫≠p nh·∫≠t:</span>
              <span>${formattedDateUpdate}</span>
            </div>
            <div class="info-row">
              <span>B√†n:</span>
              <span>${tableNumber || 'Mang v·ªÅ'}</span>
            </div>
            <div class="info-row">
              <span>Kh√°ch h√†ng:</span>
              <span>${username}</span>
            </div>
            <div class="info-row">
              <span>Ghi ch√∫:</span>
              <span>${note}</span>
            </div>
          </div>

          <div class="order-items-section">
            <h4>Danh s√°ch m√≥n ƒÉn:</h4>
            <div class="order-items-list">
              ${orderItemsHtml}
            </div>
          </div>

          <div class="order-total">
            <strong>T·ªïng ti·ªÅn: ${formattedAmount}</strong>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-success" onclick="startAddItemsToOrder(`${id}`)">
            <span>üçΩÔ∏è</span> G·ªçi th√™m m√≥n
          </button>
          <button class="btn btn-primary" onclick="updateOrderStatus(`${id}`)">
            C·∫≠p nh·∫≠t tr·∫°ng th√°i
          </button>
          <button class="btn btn-secondary" onclick="closeOrderDetails()">
            ƒê√≥ng
          </button>
        </div>
      </div>
    </div>
  </template>

  <!-- Order Item Template -->
  <template id="orderItemTemplate">
    <div class="order-item">
      <div class="item-info">
        <strong>{itemName}</strong>
        <span class="item-details">SL: {quantity} √ó {formattedPrice}</span>
      </div>
      <div class="item-status">
        <span class="badge {statusClass}">{statusText}</span>
      </div>
    </div>
  </template>

  <!-- Status Update Modal Template -->
  <template id="statusUpdateModalTemplate">
    <div class="modal-overlay" onclick="closeStatusUpdateModal()">
      <div class="modal-content status-update-modal" onclick="event.stopPropagation()">
        <div class="modal-header">
          <h3>C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng #{orderId}</h3>
          <button class="btn-close" onclick="closeStatusUpdateModal()">&times;</button>
        </div>

        <div class="modal-body">
          <div class="form-group">
            <label><strong>Ch·ªçn m√≥n ƒÉn c·∫ßn c·∫≠p nh·∫≠t:</strong></label>
            <div class="order-items-selection">
              <div class="select-all-option">
                <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                <label for="selectAll"><strong>Ch·ªçn t·∫•t c·∫£</strong></label>
              </div>
              <div id="orderItemsOptions">
                <!-- Order items checkboxes will be inserted here -->
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="newStatus"><strong>Tr·∫°ng th√°i m·ªõi:</strong></label>
            <select id="newStatus" class="form-control">
              <option value="">-- Ch·ªçn tr·∫°ng th√°i --</option>
              <option value="PENDING">Ch·ªù x√°c nh·∫≠n</option>
              <option value="CONFIRMED">ƒê√£ x√°c nh·∫≠n</option>
              <option value="COMPLETED">Ho√†n th√†nh</option>
              <option value="CANCELLED">ƒê√£ h·ªßy</option>
            </select>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-primary" onclick="executeStatusUpdate()">
            C·∫≠p nh·∫≠t tr·∫°ng th√°i
          </button>
          <button class="btn btn-secondary" onclick="closeStatusUpdateModal()">
            H·ªßy
          </button>
        </div>
      </div>
    </div>
  </template>

  <!-- Order Item Option Template -->
  <template id="orderItemOptionTemplate">
    <div class="order-item-option" data-item-id="{itemId}">
      <div class="item-info">
        <input type="checkbox" id="item_{itemId}" value="{itemId}">
        <label for="item_{itemId}">
          <strong>{menuItemName}</strong>
          <span class="item-details">SL: {quantity} - Tr·∫°ng th√°i hi·ªán t·∫°i:
            <span class="badge {statusClass}">{statusText}</span>
          </span>
        </label>
      </div>
    </div>
  </template>

  <!-- Bootstrap JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>

</html>