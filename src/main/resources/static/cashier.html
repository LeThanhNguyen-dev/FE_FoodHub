<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cashier Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&family=Pacifico&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <style>
    :root {
      --primary: #FEA116;
      --light: #F1F8FF;
      --dark: #0F172B;
      --success: #10B981;
      --warning: #F59E0B;
      --danger: #EF4444;
      --info: #3B82F6;
      --gradient-primary: linear-gradient(135deg, #FEA116, #ff8c00);
      --gradient-dark: linear-gradient(135deg, #0F172B, #1e293b);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Nunito', sans-serif;
      background-color: var(--light);
      line-height: 1.6;
    }

    /* Thêm các style khác từ CSS bạn cung cấp... */
    .price-range {
      margin-bottom: 10px;
    }

    #priceRange, #priceRangeMax {
      width: 100%;
      margin: 5px 0;
    }

    #priceRangeDisplay {
      text-align: center;
      margin: 5px 0;
    }

    .apply-btn, .close-btn {
      width: 100%;
      padding: 5px;
      margin: 5px 0;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .close-btn {
      background-color: #6c757d;
    }

    .action-btn,
    .btn.btn-outline-primary {
      text-decoration: none;
      border-bottom: none;
      box-shadow: none;
      display: inline-block;
      width: 100%;
      max-width: 150px;
      padding: 8px 14px;
      font-size: 14px;
      text-align: center;
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      min-height: 30px;
      height: 30px;
      cursor: pointer;
      font-weight: bold;
      border: none;
      border-radius: 6px;
    }

    .process-btn {
      background-color: #4CAF50;
      color: white;
    }

    .cancel-btn {
      background-color: #f44336;
      color: white;
    }

    #transactionsTable tbody tr {
      border-bottom: 1px solid #ddd;
      vertical-align: middle;
      height: 60px;
    }

    #transactionsTable td.action-buttons:empty {
      border-bottom: none;
      padding: 0;
      background: transparent;
    }

    #transactionsTable .action-buttons {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100%;
      padding: 5px 0;
    }

    .invoice {
      display: none;
      width: 100%;
      max-width: 600px;
      margin: 2rem auto;
      font-family: Arial, sans-serif;
      background: white;
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      border: 2px solid #e2e8f0;
      position: relative;
    }

    .invoice * {
      visibility: visible;
    }

    .invoice-header, .invoice-body, .invoice-footer {
      padding: 10px;
    }

    .invoice-header {
      background: var(--gradient-primary);
      color: white;
      padding: 2rem;
      text-align: center;
      position: relative;
    }

    .invoice-header::before {
      content: '🧾';
      font-size: 3rem;
      display: block;
      margin-bottom: 0.5rem;
      opacity: 0.9;
    }

    .invoice-header h3 {
      font-size: 1.8rem;
      font-weight: 700;
      margin: 0;
      font-family: 'Pacifico', cursive;
    }

    .invoice-header .invoice-subtitle {
      font-size: 1rem;
      opacity: 0.9;
      margin-top: 0.5rem;
    }

    .invoice-body {
      padding: 2rem;
    }

    .invoice-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: linear-gradient(135deg, #f8fafc, #e2e8f0);
      border-radius: 15px;
      border-left: 4px solid var(--primary);
    }

    .invoice-info-left, .invoice-info-right {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }

    .invoice-info p {
      margin: 0;
      display: flex;
      align-items: center;
      color: var(--dark);
      font-weight: 500;
    }

    .invoice-info strong {
      color: var(--primary);
      font-weight: 700;
      margin-right: 0.5rem;
      min-width: 100px;
    }

    .invoice-info span {
      color: var(--dark);
      font-weight: 600;
    }

    .invoice-table-wrapper {
      margin: 2rem 0;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      border: 1px solid #e2e8f0;
    }

    #invoiceTable {
      width: 100%;
      border-collapse: collapse;
      margin: 0;
      box-shadow: none;
    }

    #invoiceTable th {
      background: var(--gradient-dark);
      color: white;
      padding: 1.2rem 1rem;
      font-weight: 600;
      text-align: center;
      font-size: 0.95rem;
    }

    #invoiceTable td {
      padding: 1rem;
      text-align: center;
      border-bottom: 1px solid #f1f5f9;
      font-weight: 500;
      color: var(--dark);
    }

    #invoiceTable tbody tr:nth-child(even) {
      background: #f8fafc;
    }

    #invoiceTable tbody tr:hover {
      background: rgba(254, 161, 22, 0.05);
      transform: scale(1.01);
      transition: all 0.2s ease;
    }

    .invoice-summary {
      background: linear-gradient(135deg, #fff, #f8fafc);
      border-radius: 15px;
      padding: 1.5rem;
      margin: 2rem 0;
      border: 2px solid var(--primary);
      position: relative;
    }

    .invoice-summary::before {
      content: '💰';
      position: absolute;
      top: -15px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 0 10px;
      font-size: 1.5rem;
    }

    .invoice-total {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding: 1rem;
      background: var(--gradient-primary);
      color: white;
      border-radius: 10px;
      font-size: 1.3rem;
      font-weight: 700;
    }

    .invoice-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }

    .invoice-detail-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8rem;
      background: white;
      border-radius: 8px;
      border-left: 3px solid var(--primary);
    }

    .invoice-detail-item strong {
      color: var(--dark);
      font-weight: 600;
    }

    .invoice-detail-item span {
      color: var(--primary);
      font-weight: 700;
    }

    .status-badge {
      display: inline-block;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9rem;
      text-transform: uppercase;
    }

    .status-success {
      background: rgba(16, 185, 129, 0.15);
      color: var(--success);
      border: 1px solid var(--success);
    }

    .status-pending {
      background: rgba(245, 158, 11, 0.15);
      color: var(--warning);
      border: 1px solid var(--warning);
    }

    .payment-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9rem;
      background: rgba(59, 130, 246, 0.15);
      color: var(--info);
      border: 1px solid var(--info);
    }

    .invoice-footer {
      background: var(--gradient-dark);
      color: white;
      padding: 1.5rem;
      text-align: center;
      font-size: 0.95rem;
      line-height: 1.8;
    }

    .invoice-footer strong {
      color: var(--primary);
      font-size: 1.1rem;
    }

    .download-btn {
      background: var(--gradient-primary);
      border: none;
      padding: 1rem 2rem;
      border-radius: 12px;
      color: white;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 1.5rem auto 0;
      display: block;
      min-width: 200px;
      box-shadow: 0 5px 15px rgba(254, 161, 22, 0.3);
    }

    .download-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(254, 161, 22, 0.4);
    }

    .download-btn i {
      margin-right: 0.5rem;
    }

    .revenue-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-top: 20px;
      padding: 10px;
    }

    .stat-card {
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
      padding: 16px 20px;
      transition: transform 0.2s ease;
      border-left: 6px solid #FFA500;
    }

    .stat-card:hover {
      transform: translateY(-4px);
    }

    .stat-card h4 {
      margin: 0 0 8px;
      font-size: 16px;
      font-weight: 600;
      color: #333;
    }

    .stat-card .value {
      font-size: 20px;
      font-weight: bold;
      color: #FF6600;
    }

    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-start;
    }

    .result-info {
      background-color: #f0f9ff;
      border: 1px solid #a3d8ff;
      border-radius: 8px;
      padding: 16px;
      margin-top: 10px;
      font-family: Arial, sans-serif;
      line-height: 1.6;
      color: #333;
    }

    .result-info p {
      margin: 8px 0;
    }

    .result-info span {
      font-weight: bold;
      color: #007acc;
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 280px;
      background: var(--dark);
      transition: all 0.3s ease;
      z-index: 1000;
      overflow-y: auto;
      box-shadow: 4px 0 15px rgba(0, 0, 0, 0.1);
    }

    .sidebar.collapsed {
      width: 70px;
    }

    .sidebar .brand {
      padding: 2rem 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
    }

    .sidebar .brand h3 {
      color: var(--primary);
      margin: 0;
      font-family: 'Pacifico', cursive;
      font-size: 1.5rem;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: all 0.3s ease;
    }

    .sidebar .brand .subtitle {
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
      margin-top: 0.5rem;
      text-align: center;
      transition: all 0.3s ease;
    }

    .sidebar .brand .brand-icon {
      color: var(--primary);
      font-size: 1.5rem;
      transition: all 0.3s ease;
    }

    .sidebar .brand .brand-text {
      margin-left: 0.5rem;
      color: var(--primary);
      transition: all 0.3s ease;
    }

    .sidebar.collapsed .brand .brand-text,
    .sidebar.collapsed .brand .subtitle {
      display: none;
    }

    .sidebar.collapsed .brand .brand-icon {
      margin: 0;
      text-align: center;
      display: block;
    }

    .sidebar-nav {
      padding: 1rem 0;
      flex: 1;
    }

    .nav-item {
      margin-bottom: 0.5rem;
    }

    .nav-link {
      display: flex;
      align-items: center;
      padding: 1rem 1.5rem;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: all 0.3s ease;
      cursor: pointer;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      font-size: 1rem;
    }

    .nav-link:hover, .nav-link.active {
      background: rgba(254, 161, 22, 0.1);
      color: var(--primary);
      transform: translateX(5px);
    }

    .nav-link i {
      width: 20px;
      margin-right: 1rem;
      text-align: center;
      font-size: 1.1rem;
    }

    .sidebar.collapsed .nav-link span {
      display: none;
    }

    .sidebar.collapsed .nav-link i {
      margin-right: 0;
    }

    .sidebar.collapsed .nav-link {
      justify-content: center;
      padding: 1rem;
    }

    .main-content {
      margin-left: 280px;
      transition: all 0.3s ease;
      min-height: 100vh;
      overflow: auto; /* Đảm bảo nội dung không bị ẩn */
    }

    .main-content.expanded {
      margin-left: 70px;
    }

    .top-bar {
      background: #fff;
      padding: 1rem 2rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 999;
    }

    .top-bar h1 {
      color: var(--dark);
      font-weight: 700;
      font-size: 1.8rem;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      color: var(--dark);
      font-weight: 600;
    }

    .toggle-sidebar {
      background: none;
      border: none;
      color: var(--dark);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .toggle-sidebar:hover {
      background: var(--light);
    }

    .carousel {
      position: relative;
      margin: 2rem;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      height: 400px;
    }

    .carousel-item {
      display: none;
      position: relative;
      width: 100%;
      height: 100%;
    }

    .carousel-item.active {
      display: block;
    }

    .carousel-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .carousel-text {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
      color: white;
      padding: 2rem;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .carousel-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.9);
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .carousel-arrow:hover {
      background: white;
      transform: translateY(-50%) scale(1.1);
    }

    .carousel-arrow.prev {
      left: 20px;
    }

    .carousel-arrow.next {
      right: 20px;
    }

    .carousel-nav {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
    }

    .nav-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.5);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .nav-dot.active {
      background: var(--primary);
      transform: scale(1.2);
    }

    .nav-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      padding: 2rem;
    }

    .nav-buttons button {
      background: var(--gradient-primary);
      border: none;
      padding: 1.5rem;
      border-radius: 15px;
      color: white;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(254, 161, 22, 0.3);
    }

    .nav-buttons button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(254, 161, 22, 0.4);
    }

    .nav-buttons button.active {
      background: var(--gradient-dark);
    }

    .success, .error {
      margin: 1rem 2rem;
      padding: 1rem;
      border-radius: 10px;
      font-weight: 600;
      display: none;
    }

    .success {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
      border: 1px solid var(--success);
    }

    .error {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger);
      border: 1px solid var(--danger);
    }

    .section {
      display: none;
      margin: 2rem;
      background: white;
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      position: relative;
      z-index: 1;
    }

    .section.active {
      display: block !important;
    }

    .section h2 {
      color: var(--dark);
      font-weight: 700;
      margin-bottom: 2rem;
      font-size: 1.8rem;
    }

    .form-container {
      background: linear-gradient(135deg, #fff, #f8fafc);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      margin-bottom: 2rem;
    }

    .form-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .form-header h1 {
      color: var(--dark);
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .form-header p {
      color: #64748b;
      font-size: 1rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--dark);
      font-weight: 600;
    }

    .input-wrapper {
      position: relative;
      width: 100%;
    }

    .form-input, input, select {
      width: 100%;
      padding: 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: white;
    }

    .form-input:focus, input:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(254, 161, 22, 0.1);
    }

    .input-wrapper .icon {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--primary);
      pointer-events: none;
    }

    .quick-select {
      margin: 2rem 0;
    }

    .quick-select h3 {
      color: var(--dark);
      margin-bottom: 1rem;
      font-weight: 600;
    }

    .quick-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 1rem;
    }

    .quick-btn {
      background: rgba(254, 161, 22, 0.1);
      border: 2px solid var(--primary);
      padding: 0.8rem;
      border-radius: 10px;
      color: var(--primary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .quick-btn:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-2px);
    }

    .submit-btn, button[type="button"] {
      background: var(--gradient-primary);
      border: none;
      padding: 1rem 2rem;
      border-radius: 12px;
      color: white;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 1rem;
    }

    .submit-btn:hover, button[type="button"]:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(254, 161, 22, 0.4);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      margin-top: 2rem;
    }

    th, td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }

    th {
      background: var(--gradient-primary);
      color: white;
      font-weight: 600;
    }

    tr:hover {
      background: rgba(254, 161, 22, 0.05);
    }

    .error-message {
      color: var(--danger);
      font-size: 0.9rem;
      margin-top: 0.5rem;
      display: none;
    }





  /* Container chứa các nút lọc */
  #filterContainer {
    padding: 20px;
    border-radius: 12px;
    background: linear-gradient(135deg, #fff7e6 0%, #ffecd1 100%);
    box-shadow: 0 4px 15px rgba(255, 165, 0, 0.1);
    margin: 20px 0;
    position: relative; /* Tham chiếu cho .filter-menu */
    overflow: visible; /* Đảm bảo không cắt menu */
  }

  #filterContainer h3 {
    color: #e65100;
    margin-bottom: 15px;
    font-weight: 600;
  }

  /* Hàng chứa các nút lọc */
  .filter-buttons-row {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 15px;
  }

  /* Styling cho các nút lọc chính */
  .filter-btn {
    background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    font-size: 14px;
    transition: all 0.3s ease;
    box-shadow: 0 3px 10px rgba(255, 152, 0, 0.3);
    position: relative;
    overflow: hidden;
  }

  .filter-btn:hover {
    background: linear-gradient(135deg, #f57c00 0%, #e65100 100%);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
  }

  .filter-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 8px rgba(255, 152, 0, 0.3);
  }

  /* Hiệu ứng ripple cho nút */
  .filter-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transition: width 0.6s, height 0.6s, top 0.6s, left 0.6s;
    transform: translate(-50%, -50%);
  }

  .filter-btn:active::before {
    width: 300px;
    height: 300px;
  }

  /* Menu dropdown cho các options */
  .filter-menu {
    display: none;
    background: white;
    border-radius: 8px;
    box-shadow: 0 8px 25px rgba(255, 152, 0, 0.2);
    border: 2px solid #ffcc80;
    margin-top: 8px;
    overflow: hidden;
    z-index: 1002;
    position: absolute;
    padding: 5px 0;
    min-width: 120px;
    max-height: 200px;
    overflow-y: auto;
    animation: slideDown 0.3s ease-out;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Các item trong menu */
  .filter-item {
    padding: 12px 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    color: #e65100;
    font-weight: 500;
    border-bottom: 1px solid #ffe0b2;
  }

  .filter-item:last-child {
    border-bottom: none;
  }

  .filter-item:hover {
    background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
    color: #bf360c;
    transform: translateX(5px);
    padding-left: 20px;
  }

  .filter-item:active {
    background: linear-gradient(135deg, #ffe0b2 0%, #ffcc80 100%);
  }

  /* Styling cho menu lọc giá */
  #priceFilterMenu {
    width: 280px;
    padding: 15px;
  }

  .price-range {
    margin-bottom: 15px;
  }

  .price-range label {
    color: #e65100;
    font-weight: 600;
    margin-bottom: 10px;
    display: block;
  }

  /* Styling cho range slider */
  input[type="range"] {
    width: 100%;
    height: 6px;
    border-radius: 3px;
    background: #ffe0b2;
    outline: none;
    margin: 5px 0;
    -webkit-appearance: none;
  }

  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
    cursor: pointer;
    box-shadow: 0 3px 8px rgba(255, 152, 0, 0.3);
    transition: all 0.3s ease;
  }

  input[type="range"]::-webkit-slider-thumb:hover {
    background: linear-gradient(135deg, #f57c00 0%, #e65100 100%);
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(255, 152, 0, 0.4);
  }

  input[type="range"]::-moz-range-thumb {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
    cursor: pointer;
    border: none;
    box-shadow: 0 3px 8px rgba(255, 152, 0, 0.3);
  }

  /* Display giá trị range */
  #priceRangeDisplay {
    text-align: center;
    color: #e65100;
    font-weight: 600;
    margin: 10px 0;
    padding: 8px;
    background: #fff3e0;
    border-radius: 6px;
    border: 1px solid #ffcc80;
  }

  /* Nút apply và close */
  .apply-btn, .close-btn {
    background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    margin: 5px;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(255, 152, 0, 0.3);
  }

  .apply-btn:hover, .close-btn:hover {
    background: linear-gradient(135deg, #f57c00 0%, #e65100 100%);
    transform: translateY(-1px);
    box-shadow: 0 3px 10px rgba(255, 152, 0, 0.4);
  }

  .close-btn {
    background: linear-gradient(135deg, #ffb74d 0%, #ff9800 100%);
    margin-top: 10px;
    width: 100%;
  }

  /* Tùy chọn giá */
  .price-options {
    border-top: 2px solid #ffe0b2;
    margin-top: 15px;
    padding-top: 15px;
  }

  /* Responsive design */
  @media (max-width: 768px) {
    .filter-buttons-row {
      flex-direction: column;
    }

    .filter-btn {
      width: 100%;
      margin-bottom: 8px;
    }

    #priceFilterMenu {
      width: 100% !important;
      max-width: 300px;
    }
  }

  /* Active state cho nút đang được chọn */
  .filter-btn.active {
    background: linear-gradient(135deg, #e65100 0%, #bf360c 100%);
    box-shadow: 0 4px 15px rgba(230, 81, 0, 0.4);
  }

  .filter-btn.active::after {
    content: '✓';
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    font-weight: bold;
  }

    .search-input-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      max-height: 150px;
      overflow-y: auto;
      background: white;
      border: 1px solid #ccc;
      z-index: 1000;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .suggestion-item {
      padding: 5px 10px;
      cursor: pointer;
    }

    .suggestion-item:hover {
      background: #f0f0f0;
    }

    .payment-popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .popup-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }

    .popup-content select {
      margin: 10px 0;
      padding: 5px;
    }

    .popup-content button {
      margin: 0 5px;
      padding: 5px 10px;
      cursor: pointer;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .invoice.show {
      animation: slideInUp 0.5s ease-out;
    }

    @keyframes slideInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.show {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .nav-buttons {
        grid-template-columns: 1fr;
        padding: 1rem;
      }

      .quick-buttons {
        grid-template-columns: 1fr;
      }

      .carousel {
        height: 200px;
        margin: 1rem;
      }

      .section {
        margin: 1rem;
        padding: 1rem;
      }

      .section.active {
        display: block !important;
      }
    }

      .calendar-nav {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 40px;
        margin-bottom: 20px;
      }

      .nav-btn {
        background: var(--gradient-primary);
        border: none;
        padding: 12px 20px;
        border-radius: 12px;
        color: white;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(254, 161, 22, 0.2);
      }

      .nav-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(254, 161, 22, 0.3);
      }

      .week-display {
        font-size: 1.2rem;
        color: var(--primary);
        font-weight: 700;
        min-width: 200px;
        text-align: center;
      }

      .schedule-calendar {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        overflow: hidden;
        margin-top: 20px;
      }

      .schedule-day-header {
        background: var(--gradient-primary);
        color: white;
        padding: 15px 10px;
        text-align: center;
        font-weight: 700;
        font-size: 0.95rem;
      }

      .schedule-day-cell {
        background: rgba(255, 255, 255, 0.05);
        min-height: 120px;
        padding: 15px 10px;
      }

      .schedule-day-number {
        font-weight: 700;
        font-size: 1rem;
        margin-bottom: 10px;
        color: var(--primary);
        display: inline-block;
        padding: 5px 8px;
        border-radius: 6px;
        background: rgba(254, 161, 22, 0.1);
      }

      .schedule-shifts-container {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .schedule-shift-group {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .schedule-shift-header {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--primary);
        text-transform: uppercase;
        margin-bottom: 2px;
      }

      .schedule-employee-card {
        background: rgba(254, 161, 22, 0.15);
        border: 2px solid #45b7d1;
        border-radius: 6px;
        padding: 8px;
        transition: background 0.3s;
      }

      .schedule-employee-card:hover {
        background: rgba(254, 161, 22, 0.25);
      }

      .schedule-employee-info {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
      }

      .schedule-employee-name {
        font-size: 0.85rem;
        font-weight: 600;
        color: white;
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .legend {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
        flex-wrap: wrap;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
      }
      .submit-btn {
    background: var(--gradient-primary);
    border: none;
    padding: 12px 20px;
    border-radius: 12px;
    color: white;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(254, 161, 22, 0.2);
    margin: 10px 0;
  }

  .submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(254, 161, 22, 0.3);
  }
  </style>


</head>

<body>
<!-- Sidebar -->
<div class="sidebar" id="sidebar">
  <div class="brand">
    <h3><span class="brand-icon">🍴</span><span class="brand-text">FoodHub</span></h3>
    <div class="subtitle">Cashier System</div>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-item">
      <button class="nav-link" onclick="showSection('home')" id="sidebarHome">
        <i class="fas fa-home"></i><span>Home</span>
      </button>
    </div>
    <div class="nav-item">
      <button class="nav-link" onclick="showSection('transactions')" id="sidebarTransactions">
        <i class="fas fa-list-alt"></i><span>Transactions</span>
      </button>
    </div>
    <div class="nav-item">
      <button class="nav-link" onclick="showSection('revenue')" id="sidebarRevenue">
        <i class="fas fa-chart-line"></i><span>Revenue</span>
      </button>
    </div>
    <div class="nav-item">
      <button class="nav-link" onclick="showSection('schedule')" id="sidebarSchedule">
        <i class="fas fa-calendar"></i><span>Schedule</span>
      </button>
    </div>
  </nav>
</div>

<!-- Main Content -->
<div class="main-content" id="mainContent">
  <!-- Top Bar -->
  <div class="top-bar">
    <div style="display: flex; align-items: center; gap: 1rem;">
      <button class="toggle-sidebar" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
      </button>
      <h1>🛒 Cashier Dashboard</h1>
    </div>
    <div class="user-info">
      <span>👤 Cashier: Huỳnh Tiến Dê</span>
      <span>|</span>
      <span id="current-time"></span>
    </div>
  </div>

  <!-- Enhanced Carousel -->
  <div class="carousel">
    <div class="carousel-item active">
      <img src="images/pho-nha-lam.jpg" alt="Phở Bò Thơm Ngon">
      <div class="carousel-text">🍜 Phở Bò Thơm Ngon</div>
    </div>
    <div class="carousel-item">
      <img src="images/42c930c5-2a1a-429c-a002-eb2c57d700f5.jpg" alt="Cơm Tấm Sườn Nướng">
      <div class="carousel-text">🍖 Cơm Tấm Sườn Nướng</div>
    </div>
    <div class="carousel-item">
      <img src="images/top-1-mon-sandwich-ngon-nhat-the-gioi-goi-ten-banh-my-viet-nam1710498007-182420240316092132.jpg" alt="Bánh Mì VN">
      <div class="carousel-text">🥖 Bánh Mì Việt Nam</div>
    </div>
    <div class="carousel-item">
      <img src="images/bunbohue.jpg" alt="Bún Bò Huế">
      <div class="carousel-text">🌶️ Bún Bò Huế</div>
    </div>
    <button class="carousel-arrow prev" onclick="prevSlide()">‹</button>
    <button class="carousel-arrow next" onclick="nextSlide()">›</button>
    <div class="carousel-nav">
      <div class="nav-dot active" onclick="currentSlide(1)"></div>
      <div class="nav-dot" onclick="currentSlide(2)"></div>
      <div class="nav-dot" onclick="currentSlide(3)"></div>
      <div class="nav-dot" onclick="currentSlide(4)"></div>
    </div>
  </div>

  <!-- Messages -->
  <div id="message" class="success"></div>
  <div id="error" class="error"></div>

  <!-- Home Section -->
  <div class="section active" id="homeSection"></div>

  <!-- Transactions Section -->
  <div class="section" id="transactionsSection">
    <h2>📊 Transactions by Date</h2>
    <div class="form-container">
      <div class="form-header">
        <h1>📅 Filter Transactions</h1>
        <p>Chọn khoảng ngày để tra cứu giao dịch</p>
      </div>
      <form id="transactionsForm">
        <div class="form-group">
          <label for="transactionsStartDateInput">📅 Ngày Bắt Đầu</label>
          <div class="input-wrapper">
            <input type="date" id="transactionsStartDateInput" name="startDate" class="form-input" required>
            <span class="icon">📅</span>
          </div>
          <div class="error-message" id="transactionsStartDateError"></div>
        </div>
        <div class="form-group">
          <label for="transactionsEndDateInput">📅 Ngày Kết Thúc</label>
          <div class="input-wrapper">
            <input type="date" id="transactionsEndDateInput" name="endDate" class="form-input" required>
            <span class="icon">📅</span>
          </div>
          <div class="error-message" id="transactionsEndDateError"></div>
        </div>
        <div class="quick-select">
          <h3>🚀 Chọn Nhanh Ngày</h3>
          <div class="quick-buttons">
            <button type="button" class="quick-btn" data-range="today">Hôm nay</button>
            <button type="button" class="quick-btn" data-range="yesterday">Hôm qua</button>
            <button type="button" class="quick-btn" data-range="lastWeek">Tuần trước</button>
            <button type="button" class="quick-btn" data-range="lastMonth">Tháng trước</button>
          </div>
        </div>
        <button type="submit" class="submit-btn">✨ Xem Giao Dịch</button>
      </form>
    </div>
    <div class="filter-container" style="display: none;" id="filterContainer">
      <h3>🔍 Lọc Giao Dịch</h3>
      <div class="input-wrapper filter-buttons-row">
        <button class="filter-btn" id="statusFilterBtn" onclick="showFilterMenu('status')">Lọc Theo Trạng Thái</button>
        <button class="filter-btn" id="priceFilterBtn" onclick="showPriceFilter()">Lọc Theo Giá</button>
        <button class="filter-btn" id="sortPriceBtn" onclick="showFilterMenu('sortPrice')">Sắp xếp Theo Giá</button>
        <button class="filter-btn" id="methodFilterBtn" onclick="showFilterMenu('method')">Lọc Theo Phương Thức</button>
      </div>
      <div class="filter-menu" id="statusFilterMenu" style="display: none;">
        <div class="filter-item" onclick="applyFilter('status', 'all')">Tất cả</div>
        <div class="filter-item" onclick="applyFilter('status', 'PENDING')">Đang chờ</div>
        <div class="filter-item" onclick="applyFilter('status', 'CANCELLED')">Đã hủy</div>
        <div class="filter-item" onclick="applyFilter('status', 'PAID')">Đã thanh toán</div>
      </div>
      <div class="filter-menu" id="priceFilterMenu" style="display: none; width: 250px; padding: 10px;">
        <div class="price-range">
          <label for="priceRange">Mức giá: <span id="priceRangeValue">0 - 1.200.000</span> VNĐ</label>
          <input type="range" id="priceRange" min="0" max="1200000" step="10000" value="0" oninput="updatePriceRange()">
          <input type="range" id="priceRangeMax" min="0" max="1200000" step="10000" value="1200000" oninput="updatePriceRange()">
          <div id="priceRangeDisplay">0 - 1.200.000 VNĐ</div>
          <button class="apply-btn" onclick="applyPriceFilter()">Áp dụng</button>
        </div>
        <div class="price-options">
          <div class="filter-item" onclick="applyPriceFilter(null)">Lọc Tất cả</div>
          <div class="filter-item" onclick="applyPriceFilter('0-5000000')">Dưới 5 triệu</div>
          <div class="filter-item" onclick="applyPriceFilter('0-7000000')">Dưới 7 triệu</div>
          <div class="filter-item" onclick="applyPriceFilter('1000000-2000000')">1 đến 2 triệu</div>
          <div class="filter-item" onclick="applyPriceFilter('1000000-3000000')">1 đến 3 triệu</div>
          <div class="filter-item" onclick="applyPriceFilter('0-1000000')">Dưới 1 triệu</div>
          <div class="filter-item" onclick="applyPriceFilter('0-200000')">Từ 0-200k</div>
          <div class="filter-item" onclick="applyPriceFilter('200000-500000')">Từ 200-500k</div>
          <div class="filter-item" onclick="applyPriceFilter('500000-1000000')">Từ 500-1000k</div>
          <div class="filter-item" onclick="applyPriceFilter('7000000-12000000')">Trên 7 triệu</div>
        </div>
        <button class="close-btn" onclick="hidePriceFilter()">Thu gọn</button>
      </div>
      <div class="filter-menu" id="sortPriceFilterMenu" style="display: none;">
        <div class="filter-item" onclick="applySortFilter('price', null)">Tất cả</div>
        <div class="filter-item" onclick="applySortFilter('price', 'asc')">Giá tăng dần</div>
        <div class="filter-item" onclick="applySortFilter('price', 'desc')">Giá giảm dần</div>
      </div>
      <div class="filter-menu" id="methodFilterMenu" style="display: none;">
        <div class="filter-item" onclick="applyFilter('method', null)">Tất cả</div>
        <div class="filter-item" onclick="applyFilter('method', 'VNPAY')">VNPAY</div>
        <div class="filter-item" onclick="applyFilter('method', 'CASH')">CASH</div>
      </div>
    </div>
    <div class="search-container" style="display: none;" id="searchContainer">
      <h3>🔎 Tìm Kiếm Giao Dịch</h3>
      <div class="input-wrapper">
        <input type="text" id="searchTransactionInput" class="form-input" placeholder="Nhập Order ID, Transaction ID..." autocomplete="off">
        <span class="icon">🔎</span>
        <div id="suggestionBox" class="suggestion-box" style="display: none;"></div>
      </div>
      <button type="button" id="searchTransactionBtn" class="submit-btn">Tìm Kiếm</button>
    </div>
    <div id="transactionsResult">
      <table id="transactionsTable" style="display: none;">
        <thead>
        <tr>
          <th>Order ID</th>
          <th>Amount</th>
          <th>Payment Method</th>
          <th>Status</th>
          <th>Transaction ID</th>
          <th>Created At</th>
          <th>Updated At</th>
          <th>Action</th>
        </tr>
        </thead>
        <tbody id="transactionsBody"></tbody>
      </table>
      <div id="transactionCount" style="margin-top: 10px;"></div>
    </div>
  </div>

  <!-- Invoice Section -->
  <div id="invoice" class="invoice" style="display: none;">
    <div class="invoice-header">
      <h3>HÓA ĐƠN THANH TOÁN</h3>
      <div class="invoice-subtitle">FoodHub Restaurant</div>
    </div>
    <div class="invoice-main">
      <div class="invoice-info">
        <p><strong>🆔 Số HĐ:</strong> <span id="invoiceId"></span></p>
        <p><strong>📅 Ngày:</strong> <span id="paymentDate"></span></p>
        <p><strong>🍽️ Bàn:</strong> <span id="tableNumber"></span></p>
        <p><strong>👤 Khách:</strong> <span id="customerName"></span></p>
        <p><strong>📧 Email:</strong> <span id="displayCustomerEmail"></span></p>
        <p><strong>🔗 Mã GD:</strong> <span id="transactionId"></span></p>
      </div>
      <div class="invoice-table-wrapper">
        <table id="invoiceTable">
          <thead>
          <tr>
            <th>🍽️ Tên món</th>
            <th>📊 S.L</th>
            <th>💰 Đơn giá</th>
            <th>💵 Tổng</th>
          </tr>
          </thead>
          <tbody id="invoiceItems"></tbody>
        </table>
      </div>
      <div class="invoice-summary">
        <div class="invoice-total">
          <span>💰 TỔNG CỘNG:</span>
          <span id="totalAmount"></span>
        </div>
        <div class="invoice-details">
          <div class="invoice-detail-item">
            <strong>💳 Phương thức:</strong>
            <span class="payment-badge" id="paymentMethodDisplay"></span>
          </div>
          <div class="invoice-detail-item">
            <strong>📊 Trạng thái:</strong>
            <span class="status-badge status-success" id="status"></span>
          </div>
        </div>
      </div>
    </div>
    <div class="invoice-footer">
      <strong>🍴 FoodHub Restaurant</strong><br>
      Chuyên món lẩu và nướng<br>
      📞 Hotline: 1900-1234 | 🌐 www.foodhub.vn<br>
      <em>Cảm ơn quý khách!</em>
    </div>
  </div>

  <!-- Revenue Section -->
  <div class="section" id="revenueSection">
    <h2>💰 Total Revenue by Date</h2>
    <div class="form-container">
      <div class="form-header">
        <h1>📅 Revenue Analysis</h1>
        <p>Chọn khoảng ngày để xem doanh thu</p>
      </div>
      <form id="revenueForm">
        <div class="form-group">
          <label for="revenueStartDateInput">📅 Ngày Bắt Đầu</label>
          <div class="input-wrapper">
            <input type="date" id="revenueStartDateInput" name="startDate" class="form-input" required>
            <span class="icon">📅</span>
          </div>
          <div class="error-message" id="revenueStartDateError"></div>
        </div>
        <div class="form-group">
          <label for="revenueEndDateInput">📅 Ngày Kết Thúc</label>
          <div class="input-wrapper">
            <input type="date" id="revenueEndDateInput" name="endDate" class="form-input" required>
            <span class="icon">📅</span>
          </div>
          <div class="error-message" id="revenueEndDateError"></div>
        </div>
        <div class="quick-select">
          <h3>🚀 Chọn Nhanh Ngày</h3>
          <div class="quick-buttons">
            <button type="button" class="quick-btn" data-range="today">Hôm nay</button>
            <button type="button" class="quick-btn" data-range="yesterday">Hôm qua</button>
            <button type="button" class="quick-btn" data-range="lastWeek">Tuần trước</button>
            <button type="button" class="quick-btn" data-range="lastMonth">Tháng trước</button>
          </div>
        </div>
        <button type="submit" class="submit-btn">✨ Xem Doanh Thu</button>
      </form>
    </div>
    <div id="revenueResult"></div>
  </div>

  <!-- Schedule Section -->
  <div class="section" id="scheduleSection">
    <h2>📅 Lịch Làm Việc</h2>
    <div class="form-container">
      <div class="form-header">
        <h1>📅 Xem Lịch Ca Làm</h1>
        <p>Quản lý và xem lịch làm việc của bạn</p>
      </div>
      <button type="button" class="submit-btn" onclick="loadSchedule()">Xem lịch</button>
      <div class="calendar-nav" id="calendar-nav" style="display: none;">
        <button class="nav-btn" onclick="prevWeek()">← Tuần trước</button>
        <div class="week-display" id="weekDisplay"></div>
        <button class="nav-btn" onclick="nextWeek()">Tuần sau →</button>
      </div>
      <div class="schedule-calendar" id="scheduleCalendar" style="display: none;"></div>
      <div class="legend">
        <div class="legend-item">
          <div class="schedule-employee-card cashier" style="width: 20px; height: 20px;"></div>
          <span>Thu ngân</span>
        </div>
      </div>
    </div>
  </div>


</div>


<!-- // Thư viện Font Awesome -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<!-- // Thư viện html2pdf -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://momentjs.com/downloads/moment.min.js"></script>
<script src="https://momentjs.com/downloads/moment-timezone-with-data-10-years.min.js"></script>

<script>
  // Hàm showSection
  function showSection(sectionId) {
    const sections = document.querySelectorAll('.section');
    sections.forEach(section => section.classList.remove('active'));
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => link.classList.remove('active'));
    const sidebarLink = document.getElementById(`sidebar${sectionId.charAt(0).toUpperCase() + sectionId.slice(1)}`);
    if (sidebarLink) sidebarLink.classList.add('active');
    document.getElementById(`${sectionId}Section`).classList.add('active');
    if (sectionId === 'revenue') refreshRevenue();
  }

  // Tải file PDF hóa đơn dựa trên orderId
  function downloadInvoicePdf(orderId) {
    const link = document.createElement('a');
    link.href = `${API_BASE_URL}/invoice/${orderId}/pdf`;
    link.download = `invoice_${orderId}.pdf`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  // Hiển thị chi tiết hóa đơn từ dữ liệu API
 function displayInvoice(invoiceData) {
  const data = invoiceData.result || invoiceData;
  if (!data) {
    console.error('No invoice data available');
    return;
  }

  // Hiển thị các trường hóa đơn
  document.getElementById('invoiceId').textContent = `#${data.orderId || 'N/A'}`;

  // Sử dụng formattedPaymentDate từ API nếu có, nếu không thì định dạng lại
  const paymentTime = data.formattedPaymentDate ||
    (data.paymentDate
      ? new Date(data.paymentDate).toLocaleString('vi-VN', {
          timeZone: 'Asia/Ho_Chi_Minh',
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          hour12: false
        })
      : 'N/A');
  document.getElementById('paymentDate').textContent = paymentTime;

  document.getElementById('tableNumber').textContent = data.tableNumber || 'N/A';
  document.getElementById('customerName').textContent = data.customerName || 'N/A';
  document.getElementById('displayCustomerEmail').textContent = data.customerEmail || 'N/A';
  document.getElementById('totalAmount').textContent = (data.amount || 0).toLocaleString('vi-VN') + '₫';
  document.getElementById('paymentMethodDisplay').textContent = data.paymentMethod || 'N/A';
  document.getElementById('status').textContent = data.status || 'N/A';
  document.getElementById('transactionId').textContent = data.transactionId || data.transaction_id || 'N/A';

  // Hiển thị danh sách món
  const tbody = document.getElementById('invoiceItems');
  tbody.innerHTML = '';
  (data.orderItems || []).forEach(item => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${item.itemName || 'N/A'}</td>
      <td>${item.quantity || 0}</td>
      <td>${(item.price || 0).toLocaleString('vi-VN')}₫</td>
      <td>${((item.quantity || 0) * (item.price || 0)).toLocaleString('vi-VN')}₫</td>
    `;
    tbody.appendChild(row);
  });

  // Hiển thị hóa đơn
  document.getElementById('invoice').style.display = 'block';

  // Tự động ẩn hóa đơn sau 5 giây
  setTimeout(() => {
    document.getElementById('invoice').style.display = 'none';
  }, 5000);
}

  // Xóa tất cả thông báo lỗi và tin nhắn
  function clearMessages() {
    const elements = ['message', 'error', 'transactionsStartDateError', 'transactionsEndDateError', 'revenueStartDateError', 'revenueEndDateError'];
    elements.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.textContent = '';
    });
  }

  // Hiển thị thông báo lỗi
  function showError(elementId, message) {
    const errorElement = document.getElementById(elementId);
    if (errorElement) {
      errorElement.textContent = message;
      errorElement.style.display = 'block';
    } else {
      console.error(`Element with id "${elementId}" not found`);
    }
  }

  // Cập nhật thời gian thực trên giao diện
  function updateTime() {
    const now = new Date();
    document.getElementById('current-time').textContent = now.toLocaleTimeString('vi-VN');
  }
  setInterval(updateTime, 1000);
  updateTime();

const API_BASE_URL = "http://localhost:8080/api/cashier";
  // Chuyển đổi trạng thái sidebar
  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('mainContent');
    sidebar.classList.toggle('collapsed');
    mainContent.classList.toggle('expanded');
  }

  // Tạo hiệu ứng particle động
  function createParticles() {
    for (let i = 0; i < 20; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      particle.style.left = Math.random() * 100 + '%';
      particle.style.animationDelay = Math.random() * 6 + 's';
      particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
      document.body.appendChild(particle);
    }
  }
  createParticles();

  // Xử lý carousel
  let currentSlideIndex = 0;
  const slides = document.querySelectorAll('.carousel-item');
  const dots = document.querySelectorAll('.nav-dot');
  const totalSlides = slides.length;

  function showSlide(index) {
    slides.forEach(slide => slide.classList.remove('active'));
    dots.forEach(dot => dot.classList.remove('active'));
    slides[index].classList.add('active');
    dots[index].classList.add('active');
  }

  function nextSlide() {
    currentSlideIndex = (currentSlideIndex + 1) % totalSlides;
    showSlide(currentSlideIndex);
  }

  function prevSlide() {
    currentSlideIndex = (currentSlideIndex - 1 + totalSlides) % totalSlides;
    showSlide(currentSlideIndex);
  }

  function currentSlide(n) {
    currentSlideIndex = n - 1;
    showSlide(currentSlideIndex);
  }

  let autoSlideInterval = setInterval(nextSlide, 5000);
  const carousel = document.querySelector('.carousel');
  carousel.addEventListener('mouseenter', () => clearInterval(autoSlideInterval));
  carousel.addEventListener('mouseleave', () => autoSlideInterval = setInterval(nextSlide, 5000));
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') prevSlide();
    else if (e.key === 'ArrowRight') nextSlide();
  });


  let touchStartX = 0;
  let touchEndX = 0;
  carousel.addEventListener('touchstart', (e) => touchStartX = e.changedTouches[0].screenX);
  carousel.addEventListener('touchend', (e) => {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
  });

  function handleSwipe() {
    if (touchEndX < touchStartX - 50) nextSlide();
    if (touchEndX > touchStartX + 50) prevSlide();
  }



  // Hiển thị popup chọn phương thức thanh toán
function showPaymentMethodPopup(orderId, button) {
  const popup = document.createElement('div');
  popup.className = 'payment-popup';
  popup.setAttribute('data-order-id', orderId); // Theo dõi orderId
  popup.setAttribute('data-process-button', button); // Lưu tham chiếu nút Process
  popup.innerHTML = `
    <div class="popup-content">
      <h3>Chọn phương thức thanh toán</h3>
      <select id="paymentMethodSelect">
        <option value="CASH">CASH</option>
        <option value="VNPAY">VNPAY</option>
      </select>
      <button onclick="confirmPayment(event, this)">Xác nhận</button>
      <button onclick="closePopup(this)">Hủy</button>
    </div>
  `;
  document.body.appendChild(popup);

  setTimeout(() => {
    document.addEventListener('click', function handleOutsideClick(e) {
      if (!popup.contains(e.target) && e.target !== button) {
        closePopup();
        document.removeEventListener('click', handleOutsideClick);
      }
    });
  }, 0);
}

// Đóng popup
function closePopup(button) {
  const popup = document.querySelector('.payment-popup');
  if (popup) popup.remove();
}

// Xác nhận thanh toán với phương thức đã chọn
async function confirmPayment(event, button) {
  event.preventDefault();
  const popup = button.closest('.payment-popup');
  if (!popup) return;

  const orderId = popup.getAttribute('data-order-id');
  const paymentMethod = document.getElementById('paymentMethodSelect').value;
  const processButton = popup.getAttribute('data-process-button'); // Lấy tham chiếu nút Process đã lưu

  closePopup();

  if (orderId && processButton) {
    await processPayment(orderId, paymentMethod, processButton);
  } else {
    console.error('Không tìm thấy orderId hoặc nút Process:', { orderId, processButton });
    showError("error", "❌ Lỗi hệ thống, không thể xử lý thanh toán.");
  }
}

// Xử lý thanh toán đơn hàng
async function processPayment(orderId, paymentMethod, button) {
  clearMessages();

  const originalText = button.textContent || 'Thanh toán';
  button.textContent = originalText + ' <span class="loading"></span>';
  button.disabled = true;

  try {
    const response = await fetch(`${API_BASE_URL}/payment`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ orderId, paymentMethod })
    });

    const data = await response.json();
    console.log('API Response:', data);

    if (response.ok) {
      document.getElementById('message').textContent = "🎉 Thanh toán thành công!";
      document.getElementById('message').style.display = 'block';
      setTimeout(() => document.getElementById('message').style.display = 'none', 3000);

      // Lấy dữ liệu hóa đơn
      const invoiceResponse = await fetch(`${API_BASE_URL}/invoice/${orderId}`);
      if (invoiceResponse.ok) {
        const invoiceData = await invoiceResponse.json();
        console.log('Invoice Data:', invoiceData);

        if (invoiceData.result) {
          // Hiển thị hóa đơn
          displayInvoice(invoiceData);

          // Gửi email hóa đơn nếu có email khách hàng
          if (invoiceData.result.customerEmail) {
            const emailResponse = await fetch(`${API_BASE_URL}/send-invoice-email`, {
              method: 'POST',
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ customerEmail: invoiceData.result.customerEmail, orderId })
            });

            if (emailResponse.ok) {
              document.getElementById('message').textContent += " Hóa đơn đã được gửi qua email!";
            } else {
              showError("error", `❌ Lỗi gửi email: ${await emailResponse.text()}`);
            }
          }
        } else {
          showError("error", `❌ Lỗi lấy hóa đơn: ${invoiceData.message || 'Dữ liệu hóa đơn không hợp lệ.'}`);
        }
      } else {
        showError("error", `❌ Lỗi lấy hóa đơn: ${invoiceResponse.statusText}`);
      }

      await refreshTransactions();
    } else {
      showError("error", `❌ ${data.message || "Thanh toán thất bại."}`);
    }
  } catch (error) {
    console.error("Lỗi:", error);
    showError("error", "❌ Lỗi kết nối, vui lòng thử lại.");
  } finally {
    button.textContent = originalText;
    button.disabled = false;
  }
}


// Xử lý làm mới giao dịch dựa trên form (nếu cần)
async function refreshTransactionsForm(event) {
  event.preventDefault(); // Ngăn form submit mặc định
  const button = event.submitter || document.querySelector('#transactionsForm .submit-btn');

  if (!button) {
    console.error('Nút submit không được tìm thấy');
    showError("error", "❌ Lỗi hệ thống, không thể submit form.");
    return;
  }

  const originalText = button.innerHTML || button.textContent || '✨ Xem Giao Dịch';
  button.innerHTML = originalText + '<span class="loading"></span>';
  button.disabled = true;

  try {
    const startDateInput = document.getElementById('transactionsStartDateInput').value;
    const endDateInput = document.getElementById('transactionsEndDateInput').value;

    if (!startDateInput || !endDateInput) {
      showError("error", "❌ Vui lòng chọn cả ngày bắt đầu và ngày kết thúc.");
      return;
    }

    const startDate = new Date(startDateInput);
    const endDate = new Date(endDateInput);
    if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
      showError("error", "❌ Ngày không hợp lệ, vui lòng chọn lại.");
      return;
    }

    if (endDate < startDate) {
      showError("transactionsEndDateError", "❌ Ngày kết thúc phải sau ngày bắt đầu.");
      return;
    }

    clearMessages();
    console.log('Calling refreshTransactions with dates:', startDateInput, endDateInput); // Debug
    await refreshTransactions();
  } catch (error) {
    console.error("Lỗi khi làm mới giao dịch:", error);
    showError("error", "❌ Lỗi khi tải giao dịch, vui lòng thử lại.");
  } finally {
    button.innerHTML = originalText;
    button.disabled = false;
  }
}

// Gắn event listener cho form (nếu cần)
document.getElementById('transactionsForm')?.addEventListener('submit', refreshTransactionsForm);




// Xử lý hủy hoặc hoàn tiền đơn hàng
async function cancelOrRefund(orderId) {
  if (!confirm('Bạn có chắc muốn hủy giao dịch này?')) return;

  clearMessages();
  const button = event.target;

  // Lưu originalText dưới dạng chuỗi gốc, loại bỏ các phần tử HTML thừa
  const originalText = button.textContent.replace(/<[^>]+>/g, '').trim() || 'Cancel';
  button.textContent = originalText + ' <span class="loading"></span>';
  button.disabled = true;

  try {
    const response = await fetch(`${API_BASE_URL}/cancel-or-refund/${orderId}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" }
    });
    const data = await response.json();

    if (response.ok) {
      document.getElementById('message').textContent = "✅ Đơn hàng đã được hủy thành công!";
      document.getElementById('message').style.display = 'block';
      setTimeout(() => document.getElementById('message').style.display = 'none', 3000);
      await refreshTransactions();
    } else {
      switch (data.code) {
        case 1019:
          showError("error", "❌ Đơn hàng không tồn tại.");
          break;
        case 1024:
          showError("error", "❌ Đơn hàng đã bị hủy trước đó.");
          break;
        case 1021:
          showError("error", "❌ Đơn hàng đã hoàn thành, không thể hủy.");
          break;
        case 1025:
          showError("error", "❌ Thanh toán đã được xử lý, không thể hủy.");
          break;
        case 9999:
          showError("error", "❌ Lỗi hệ thống, vui lòng thử lại sau.");
          break;
        default:
          showError("error", `❌ ${data.message || "Hủy/hoàn tiền thất bại."}`);
          break;
      }
    }
  } catch (error) {
    console.error("Cancel/Refund fetch error:", error);
    showError("error", "❌ Lỗi kết nối hệ thống, vui lòng thử lại sau.");
  } finally {
    button.textContent = originalText; // Reset về nội dung gốc
    button.disabled = false;
  }
}

  // Làm mới danh sách giao dịch

async function refreshTransactions() {
  const startDateInput = document.getElementById('transactionsStartDateInput').value;
  const endDateInput = document.getElementById('transactionsEndDateInput').value;
  const start = new Date(startDateInput);
  start.setHours(0, 0, 0, 0);
  const end = new Date(endDateInput);
  end.setHours(23, 59, 59, 999);
  const startIso = start.toISOString();
  endIso = end.toISOString();

  try {
    const response = await fetch(`${API_BASE_URL}/transactions?start=${encodeURIComponent(startIso)}&end=${encodeURIComponent(endIso)}`);
    const data = await response.json();

    if (response.ok) {
      let transactions = data.result || [];
      const tbody = document.getElementById("transactionsBody");
      tbody.innerHTML = "";
      const transactionCount = document.getElementById("transactionCount");
      if (transactions.length > 0) {
        document.getElementById("transactionsTable").style.display = "table";
        document.getElementById("filterContainer").style.display = "block";
        document.getElementById("searchContainer").style.display = "block";
        transactions.forEach(tx => {
          const row = document.createElement("tr");
          let actionButtons = '';
          if (tx.status === "PENDING") {
            actionButtons = `
              <button class="action-btn process-btn" onclick="showPaymentMethodPopup(${tx.orderId}, this)">Process</button>
              <button class="action-btn cancel-btn" onclick="cancelOrRefund(${tx.orderId})">Cancel</button>
            `;
          } else if (tx.status === "PAID") {
            actionButtons = `
              <button class="btn btn-outline-primary" onclick="downloadInvoicePdf(${tx.orderId})">
                🖨️ In Hóa Đơn
              </button>
            `;
          }
          row.innerHTML = `
            <td>${tx.orderId || 'N/A'}</td>
            <td>${(tx.amount || 0).toLocaleString()}₫</td>
            <td>${tx.paymentMethod || 'N/A'}</td>
            <td><span style="color: ${tx.status === 'PAID' ? '#2ed573' : tx.status === 'CANCELLED' ? '#ff4757' : '#ff9800'}">${tx.status || 'N/A'}</span></td>
            <td>${tx.transactionId || tx.transaction_id || 'N/A'}</td>
            <td>${tx.createdAt ? new Date(tx.createdAt).toISOString().replace('T', ' ').split('.')[0] : 'N/A'}</td>
            <td>${tx.updatedAt ? new Date(tx.updatedAt).toISOString().replace('T', ' ').split('.')[0] : 'N/A'}</td>
            <td class="action-buttons">${actionButtons}</td>
          `;
          tbody.appendChild(row);
        });
        transactionCount.textContent = `Tổng số hóa đơn: ${transactions.length}`;
      } else {
        document.getElementById("transactionsTable").style.display = "none";
        document.getElementById("filterContainer").style.display = "block";
        document.getElementById("searchContainer").style.display = "none";
        transactionCount.textContent = "Không có hóa đơn nào.";
      }
    } else {
      showError("error", `❌ ${data.message || "Không thể tải giao dịch."}`);
    }
  } catch (error) {
    showError("error", "❌ Lỗi kết nối hệ thống, vui lòng thử lại sau.");
  }
}

  // Tìm kiếm giao dịch
  async function searchTransactions() {
    const query = document.getElementById('searchTransactionInput').value.trim();
    if (!query) {
      showError('error', 'Vui lòng nhập Order ID hoặc Transaction ID!');
      return;
    }

    try {
      const startDateInput = document.getElementById('transactionsStartDateInput').value;
      const endDateInput = document.getElementById('transactionsEndDateInput').value;
      const start = new Date(startDateInput + 'T00:00:00Z');
      const end = new Date(endDateInput + 'T23:59:59Z');

      const response = await fetch(`${API_BASE_URL}/transactions?start=${start.toISOString()}&end=${end.toISOString()}`);
      const data = await response.json();

      if (response.ok) {
        let transactions = data.result || [];
        const tbody = document.getElementById("transactionsBody");
        tbody.innerHTML = "";
        const transactionCount = document.getElementById("transactionCount");
        transactions = transactions.filter(tx =>
          tx.orderId.toString().includes(query) ||
          (tx.transactionId && tx.transactionId.includes(query))
        );
        if (transactions.length > 0) {
          document.getElementById("transactionsTable").style.display = "table";
          document.getElementById("filterContainer").style.display = "block";
          document.getElementById("searchContainer").style.display = "block";
          transactions.forEach(tx => {
            const row = document.createElement("tr");
            let actionButtons = '';
            if (tx.status === "PENDING") {
              actionButtons = `
                <button class="action-btn process-btn" onclick="showPaymentMethodPopup(${tx.orderId}, this)">Process</button>
                <button class="action-btn cancel-btn" onclick="cancelOrRefund(${tx.orderId})">Cancel</button>
              `;
            } else if (tx.status === "PAID") {
              actionButtons = `
                <button class="btn btn-outline-primary" onclick="downloadInvoicePdf(${tx.orderId})">
                  🖨️ In Hóa Đơn
                </button>
              `;
            }
            row.innerHTML = `
              <td>${tx.orderId || 'N/A'}</td>
              <td>${(tx.amount || 0).toLocaleString()}₫</td>
              <td>${tx.paymentMethod || 'N/A'}</td>
              <td><span style="color: ${tx.status === 'PAID' ? '#2ed573' : tx.status === 'CANCELLED' ? '#ff4757' : '#ff9800'}">${tx.status || 'N/A'}</span></td>
              <td>${tx.transactionId || tx.transaction_id || 'N/A'}</td>
              <td>${tx.createdAt ? new Date(tx.createdAt).toISOString().replace('T', ' ').split('.')[0] : 'N/A'}</td>
              <td>${tx.updatedAt ? new Date(tx.updatedAt).toISOString().replace('T', ' ').split('.')[0] : 'N/A'}</td>
              <td class="action-buttons">${actionButtons}</td>
            `;
            tbody.appendChild(row);
          });
          transactionCount.textContent = `Tổng số hóa đơn tìm thấy: ${transactions.length}`;
        } else {
          document.getElementById("transactionsTable").style.display = "none";
          transactionCount.textContent = "Không tìm thấy hóa đơn nào.";
        }
      } else {
        showError("error", `❌ ${data.message || "Không thể tìm kiếm giao dịch."}`);
      }
    } catch (error) {
      showError("error", "❌ Lỗi kết nối hệ thống, vui lòng thử lại sau.");
    }
  }



let filters = {
  status: 'all',
  priceRange: null,
  method: null,
  sort: null
};


function showFilterMenu(type) {
    console.log(`showFilterMenu called with type: ${type}`);
    const menu = document.getElementById(`${type}FilterMenu`);
    const filterBtnId = type === 'sortPrice' ? 'sortPriceBtn' : `${type}FilterBtn`;
    const filterBtn = document.getElementById(filterBtnId);

    if (!menu || !filterBtn) {
        console.error(`Lỗi: Không tìm thấy menu ${type}FilterMenu hoặc nút ${filterBtnId}`);
        return;
    }

    // Đóng tất cả menu khác
    document.querySelectorAll('.filter-menu').forEach(m => {
        if (m !== menu) {
            m.style.display = 'none';
            console.log(`Đóng menu: ${m.id}`);
        }
    });

    // Toggle menu
    if (menu.style.display === 'block') {
        menu.style.display = 'none';
        console.log(`Ẩn menu: ${type}FilterMenu`);
    } else {
        menu.style.display = 'block';
        const filterContainer = document.getElementById('filterContainer');
        if (!filterContainer) {
            console.error('Không tìm thấy #filterContainer');
            return;
        }

        menu.style.position = 'absolute';
        const rect = filterBtn.getBoundingClientRect();
        const containerRect = filterContainer.getBoundingClientRect();
        const scrollX = window.scrollX || window.pageXOffset;
        const scrollY = window.scrollY || window.pageYOffset;

        // Đặt menu ngay dưới nút, tính tương đối với #filterContainer
        let topPos = rect.bottom - containerRect.top + 2; // +2px khoảng cách nhỏ
        let menuHeight = menu.offsetHeight;
        if (menuHeight === 0) {
            menu.style.visibility = 'hidden'; // Ẩn tạm để lấy chiều cao
            menu.style.display = 'block';
            menuHeight = menu.offsetHeight;
            menu.style.visibility = 'visible';
        }
        const viewportHeight = window.innerHeight;
        const containerBottom = containerRect.bottom + scrollY;

        // Điều chỉnh nếu menu vượt ra ngoài container hoặc viewport
        if (topPos + menuHeight > viewportHeight - containerRect.top) {
            topPos = rect.top - containerRect.top - menuHeight - 2;
            if (topPos < 0) topPos = 0; // Giữ trên cùng nếu không đủ chỗ
        }

        menu.style.left = `${rect.left - containerRect.left}px`;
        menu.style.top = `${topPos}px`;
        menu.style.zIndex = '1002';
        console.log(`Hiện menu ${type}FilterMenu tại left=${menu.style.left}, top=${menu.style.top}, height=${menuHeight}px`);
    }

    // Ngăn lan truyền click
    const stopPropagation = (e) => e.stopPropagation();
    filterBtn.addEventListener('click', stopPropagation, { once: true });

    // Xử lý click ngoài để đóng menu
    const handleOutsideClick = (e) => {
        const inputWrapper = filterBtn.closest('.input-wrapper');
        if (
            !menu.contains(e.target) &&
            !filterBtn.contains(e.target) &&
            (!inputWrapper || !inputWrapper.contains(e.target))
        ) {
            menu.style.display = 'none';
            document.removeEventListener('click', handleOutsideClick);
            console.log(`Đóng menu ${type}FilterMenu do click ngoài`);
        }
    };
    document.addEventListener('click', handleOutsideClick);
}



function applySortFilter(type, order) {
  console.log(`applySortFilter called with type: ${type}, order: ${order}`);
  if (order === null) {
    filters.sort = null; // Reset sắp xếp
  } else {
    filters.sort = { type, order };
  }
  const sortPriceBtn = document.getElementById('sortPriceBtn');
  sortPriceBtn.textContent = order === null ? 'Sắp xếp Theo Giá' : `Sắp xếp Theo Giá: ${order === 'asc' ? 'Tăng dần' : 'Giảm dần'}`;
  document.getElementById('sortPriceFilterMenu').style.display = 'none';
  filterTransactions();
}

async function filterTransactions() {
  const startDateInput = document.getElementById('transactionsStartDateInput');
  const endDateInput = document.getElementById('transactionsEndDateInput');
  const filterBtn = document.getElementById('statusFilterBtn');

  if (!startDateInput.value || !endDateInput.value) {
    showError("error", "❌ Vui lòng chọn cả ngày bắt đầu và ngày kết thúc.");
    return;
  }

  const start = new Date(startDateInput.value);
  const end = new Date(endDateInput.value);
  if (isNaN(start) || isNaN(end)) {
    showError("error", "❌ Ngày không hợp lệ.");
    return;
  }
  start.setHours(0, 0, 0, 0);
  end.setHours(23, 59, 59, 999);
  const startIso = start.toISOString();
  const endIso = end.toISOString();

  const originalText = filterBtn.textContent;
  filterBtn.textContent = originalText + ' ...';
  filterBtn.disabled = true;

  try {
    const response = await fetch(`${API_BASE_URL}/transactions?start=${encodeURIComponent(startIso)}&end=${encodeURIComponent(endIso)}`);
    const data = await response.json();

    if (response.ok) {
      let transactions = data.result || [];

      if (filters.status && filters.status !== 'all') {
        transactions = transactions.filter(tx => tx.status === filters.status);
      }

      if (filters.method) {
        transactions = transactions.filter(tx => tx.paymentMethod === filters.method);
      }

      if (filters.priceRange) {
        const [min, max] = filters.priceRange;
        transactions = transactions.filter(tx => (tx.amount || 0) >= min && (tx.amount || 0) <= max);
      }

      if (filters.sort && filters.sort.type === 'price') {
        transactions.sort((a, b) => {
          const amountA = a.amount || 0;
          const amountB = b.amount || 0;
          return filters.sort.order === 'asc' ? amountA - amountB : amountB - amountA;
        });
      }

      const tbody = document.getElementById("transactionsBody");
      tbody.innerHTML = '';
      const transactionCount = document.getElementById("transactionCount");
      if (transactions.length > 0) {
        document.getElementById("transactionsTable").style.display = "table";
        document.getElementById("filterContainer").style.display = "block";
        document.getElementById("searchContainer").style.display = "block";
        transactions.forEach(tx => {
          const row = document.createElement("tr");
          let actionButtons = '';
          if (tx.status === "PENDING") {
            actionButtons = `
              <button class="action-btn process-btn" onclick="showPaymentMethodPopup(${tx.orderId}, this)">Process</button>
              <button class="action-btn cancel-btn" onclick="cancelOrRefund(${tx.orderId})">Cancel</button>
            `;
          } else if (tx.status === "PAID") {
            actionButtons = `
              <button class="btn btn-outline-primary" onclick="downloadInvoicePdf(${tx.orderId})">
                🖨️ In Hóa Đơn
              </button>
            `;
          }
          row.innerHTML = `
            <td>${tx.orderId || 'N/A'}</td>
            <td>${(tx.amount || 0).toLocaleString()}₫</td>
            <td>${tx.paymentMethod || 'N/A'}</td>
            <td><span style="color: ${tx.status === 'PAID' ? '#2ed573' : tx.status === 'CANCELLED' ? '#ff4757' : '#ff9800'}">${tx.status || 'N/A'}</span></td>
            <td>${tx.transactionId || tx.transaction_id || 'N/A'}</td>
            <td>${tx.createdAt ? new Date(tx.createdAt).toISOString().replace('T', ' ').split('.')[0] : 'N/A'}</td>
            <td>${tx.updatedAt ? new Date(tx.updatedAt).toISOString().replace('T', ' ').split('.')[0] : 'N/A'}</td>
            <td class="action-buttons">${actionButtons}</td>
          `;
          tbody.appendChild(row);
        });
        transactionCount.textContent = `Tổng số hóa đơn: ${transactions.length} (Trạng thái: ${filters.status === 'all' ? 'Tất cả' : filters.status.charAt(0).toUpperCase() + filters.status.slice(1)}, Giá: ${filters.priceRange ? `${filters.priceRange[0]} - ${filters.priceRange[1]} VNĐ` : 'Tất cả'}, Phương thức: ${filters.method || 'Tất cả'}, Sắp xếp: ${filters.sort ? `Giá ${filters.sort.order === 'asc' ? 'tăng dần' : 'giảm dần'}` : 'Mặc định'})`;
      } else {
        document.getElementById("transactionsTable").style.display = "none";
        document.getElementById("filterContainer").style.display = "block";
        document.getElementById("searchContainer").style.display = "none";
        transactionCount.textContent = `Không có hóa đơn nào với các bộ lọc: Trạng thái ${filters.status === 'all' ? 'Tất cả' : filters.status.charAt(0).toUpperCase() + filters.status.slice(1)}, Giá ${filters.priceRange ? `${filters.priceRange[0]} - ${filters.priceRange[1]} VNĐ` : 'Tất cả'}, Phương thức: ${filters.method || 'Tất cả'}, Sắp xếp: ${filters.sort ? `Giá ${filters.sort.order === 'asc' ? 'tăng dần' : 'giảm dần'}` : 'Mặc định'}.`;
      }
    } else {
      showError("error", `❌ ${data.message || "Không thể tải giao dịch."}`);
    }
  } catch (error) {
    showError("error", "❌ Lỗi kết nối, thử lại sau.");
  } finally {
    filterBtn.textContent = originalText;
    filterBtn.disabled = false;
  }
}

function showPriceFilter() {
  showFilterMenu('price');
}

function hidePriceFilter() {
  document.getElementById('priceFilterMenu').style.display = 'none';
}

function updatePriceRange() {
  const min = document.getElementById('priceRange').value;
  const max = document.getElementById('priceRangeMax').value;
  document.getElementById('priceRangeValue').textContent = `${min} - ${max}`;
  document.getElementById('priceRangeDisplay').textContent = `${min} - ${max} VNĐ`;
}

function applyPriceFilter(range) {
  if (range === null) {
    filters.priceRange = null;
    console.log('Price filter reset to all');
  } else if (range) {
    const [min, max] = range.split('-').map(Number);
    filters.priceRange = [min, max];
    console.log('Price filter applied:', filters.priceRange);
  } else {
    const min = document.getElementById('priceRange').value;
    const max = document.getElementById('priceRangeMax').value;
    filters.priceRange = [Number(min), Number(max)];
    console.log('Price filter applied from sliders:', filters.priceRange);
  }
  filterTransactions();
  hidePriceFilter();
}

function applyFilter(type, value) {
  filters[type] = value;
  filterTransactions();
}


  // Tìm kiếm gợi ý
  // Biến toàn cục để lưu trữ start/end
let currentStartDate = null;
let currentEndDate = null;

// Hàm debounce để tối ưu hóa gọi API
function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    clearTimeout(timeout);
    timeout = setTimeout(() => func.apply(this, args), wait);
  };
}

// Hàm lấy gợi ý
async function fetchSuggestions() {
  const query = document.getElementById('searchTransactionInput').value.trim();
  const suggestionBox = document.getElementById('suggestionBox');

  if (query.length < 1) {
    suggestionBox.style.display = 'none';
    return;
  }

  const startDateInput = document.getElementById('transactionsStartDateInput').value;
  const endDateInput = document.getElementById('transactionsEndDateInput').value;
  const start = startDateInput ? new Date(startDateInput + 'T00:00:00Z') : null;
  const end = endDateInput ? new Date(endDateInput + 'T23:59:59Z') : null;

  if (!start || !end) {
    console.log('Vui lòng chọn ngày bắt đầu và kết thúc trước khi tìm kiếm.');
    suggestionBox.style.display = 'none';
    return;
  }

  currentStartDate = start.toISOString();
  currentEndDate = end.toISOString();

  try {
    const response = await fetch(`${API_BASE_URL}/transactions/suggestions?start=${encodeURIComponent(currentStartDate)}&end=${encodeURIComponent(currentEndDate)}&query=${encodeURIComponent(query)}`);
    if (!response.ok) throw new Error(`Lỗi từ server: ${response.status} - ${response.statusText}`);
    const data = await response.json();
    const suggestions = data.result || [];

    suggestionBox.innerHTML = '';
    if (suggestions.length > 0) {
      suggestions.forEach(suggestion => {
        const div = document.createElement('div');
        div.className = 'suggestion-item';
        div.textContent = suggestion; // suggestion đã được định dạng từ backend (orderId - transactionId)
        div.addEventListener('click', () => {
          document.getElementById('searchTransactionInput').value = suggestion.split(' - ')[0]; // Lấy orderId
          suggestionBox.style.display = 'none';
          searchTransactions(); // Tự động tìm kiếm sau khi chọn
        });
        suggestionBox.appendChild(div);
      });
      suggestionBox.style.display = 'block';
    } else {
      suggestionBox.style.display = 'none';
    }
  } catch (error) {
    console.error('Lỗi khi lấy gợi ý:', error);
    showError('error', '❌ Lỗi khi tải gợi ý, vui lòng thử lại.');
    suggestionBox.style.display = 'none';
  }
}

// Áp dụng debounce cho input
const debouncedFetchSuggestions = debounce(fetchSuggestions, 300);
document.getElementById('searchTransactionInput').addEventListener('input', debouncedFetchSuggestions);

// Ẩn gợi ý khi click ra ngoài
document.addEventListener('click', function(e) {
  const suggestionBox = document.getElementById('suggestionBox');
  const inputWrapper = document.querySelector('.search-container .input-wrapper');
  if (!inputWrapper.contains(e.target)) {
    suggestionBox.style.display = 'none';
  }
});



  // Làm mới thống kê doanh thu
  async function refreshRevenue() {
    const startDateInput = document.getElementById('revenueStartDateInput').value;
    const endDateInput = document.getElementById('revenueEndDateInput').value;
    const startDate = new Date(startDateInput);
    const endDate = new Date(endDateInput);
    if (endDate < startDate) {
      showError('revenueEndDateError', 'Ngày kết thúc phải sau ngày bắt đầu');
      return;
    } else {
      clearMessages();
    }

    const start = new Date(startDateInput);
    start.setHours(0, 0, 0, 0);
    const end = new Date(endDateInput);
    end.setHours(23, 59, 59, 999);
    const startIso = start.toISOString();
    const endIso = end.toISOString();

    try {
      const response = await fetch(`${API_BASE_URL}/revenue-stats?start=${encodeURIComponent(startIso)}&end=${encodeURIComponent(endIso)}`);
      const data = await response.json();
      if (response.ok) {
        const stats = data.result || {};
        document.getElementById("revenueResult").innerHTML = `
          <div class="revenue-stats">
            <div class="stat-card">
              <h4>Total Revenue</h4>
              <div class="value">${(Number(stats.totalRevenue) || 0).toLocaleString()}₫</div>
            </div>
            <div class="stat-card">
              <h4>CASH Revenue</h4>
              <div class="value">${(Number(stats.cashRevenue) || 0).toLocaleString()}₫</div>
            </div>
            <div class="stat-card">
              <h4>VNPAY Revenue</h4>
              <div class="value">${(Number(stats.vnpayRevenue) || 0).toLocaleString()}₫</div>
            </div>
            <div class="stat-card">
              <h4>Pending</h4>
              <div class="value">${(Number(stats.pendingRevenue) || 0).toLocaleString()}₫</div>
            </div>
            <div class="stat-card">
              <h4>Paid</h4>
              <div class="value">${(Number(stats.paidRevenue) || 0).toLocaleString()}₫</div>
            </div>
            <div class="stat-card">
              <h4>Cancelled</h4>
              <div class="value">${(Number(stats.cancelledRevenue) || 0).toLocaleString()}₫</div>
            </div>
          </div>
          <p>📅 From: ${startDateInput} To: ${endDateInput}</p>
        `;
        document.getElementById("message").textContent = "💰 Revenue stats loaded successfully!";
      } else {
        showError("error", `❌ ${data.message || "Không thể tải doanh thu."}`);
      }
    } catch (error) {
      showError("error", "❌ Lỗi kết nối hệ thống, vui lòng thử lại sau.");
    }
  }

  // Xử lý submit form để làm mới doanh thu
  document.getElementById('revenueForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const button = e.submitter;
    const originalText = button.innerHTML;
    button.innerHTML = originalText + '<span class="loading"></span>';
    button.disabled = true;

    const startDateInput = document.getElementById('revenueStartDateInput').value;
    const endDateInput = document.getElementById('revenueEndDateInput').value;
    const startDate = new Date(startDateInput);
    const endDate = new Date(endDateInput);
    if (endDate < startDate) {
      showError('revenueEndDateError', 'Ngày kết thúc phải sau ngày bắt đầu');
      button.innerHTML = originalText;
      button.disabled = false;
      return;
    } else {
      clearMessages();
    }

    await refreshRevenue();
    button.innerHTML = originalText;
    button.disabled = false;
  });

  // Khởi tạo trang và xử lý nút chọn nhanh ngày
  document.addEventListener('DOMContentLoaded', function() {
    showSection('transactions');

    const today = new Date();
    ['transactionsStartDateInput', 'transactionsEndDateInput', 'revenueStartDateInput', 'revenueEndDateInput'].forEach(id => {
      const input = document.getElementById(id);
      input.min = '2020-01-01';
      input.value = today.toISOString().split('T')[0];
    });

    document.querySelectorAll('.quick-btn[data-range]').forEach(btn => {
      btn.addEventListener('click', function() {
        const range = this.dataset.range;
        const today = new Date();
        const form = this.closest('form');
        const startDateInput = form.querySelector('[name="startDate"]');
        const endDateInput = form.querySelector('[name="endDate"]');

        if (range === 'today') {
          startDateInput.value = today.toISOString().split('T')[0];
          endDateInput.value = today.toISOString().split('T')[0];
        } else if (range === 'yesterday') {
          const yesterday = new Date(today);
          yesterday.setDate(today.getDate() - 1);
          startDateInput.value = yesterday.toISOString().split('T')[0];
          endDateInput.value = today.toISOString().split('T')[0];
        } else if (range === 'lastWeek') {
          const lastWeekStart = new Date(today);
          lastWeekStart.setDate(today.getDate() - 7);
          startDateInput.value = lastWeekStart.toISOString().split('T')[0];
          endDateInput.value = today.toISOString().split('T')[0];
        } else if (range === 'lastMonth') {
          const lastMonthStart = new Date(today);
          lastMonthStart.setDate(today.getDate() - 30);
          startDateInput.value = lastMonthStart.toISOString().split('T')[0];
          endDateInput.value = today.toISOString().split('T')[0];
        }

        form.querySelectorAll('.quick-btn[data-range]').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        if (form.id === 'transactionsForm') {
          document.getElementById('transactionsForm').dispatchEvent(new Event('submit'));
        } else if (form.id === 'revenueForm') {
          document.getElementById('revenueForm').dispatchEvent(new Event('submit'));
        }
      });
    });

    // Xử lý sự kiện tìm kiếm giao dịch
    document.getElementById('searchTransactionInput').addEventListener('input', async () => {
      await fetchSuggestions();
    });
    document.getElementById('searchTransactionInput').addEventListener('keypress', async (event) => {
      if (event.key === 'Enter') {
        await searchTransactions();
      }
    });
    document.getElementById('searchTransactionBtn').addEventListener('click', async () => {
      await searchTransactions();
    });
  });



let currentWeekStart = new Date('2025-06-20T15:47:00+07:00');
  currentWeekStart.setDate(currentWeekStart.getDate() - currentWeekStart.getDay());

  async function loadSchedule() {
    const calendarNav = document.getElementById('calendar-nav');
    const calendar = document.getElementById('scheduleCalendar');
    calendarNav.style.display = 'flex';
    calendar.style.display = 'grid';
    await updateCalendar();
  }

  async function updateCalendar() {
    const calendar = document.getElementById('scheduleCalendar');
    calendar.innerHTML = '';

    const days = ['Thứ 2', 'Thứ 3', 'Thứ 4', 'Thứ 5', 'Thứ 6', 'Thứ 7', 'Chủ nhật'];
    days.forEach(day => {
      const header = document.createElement('div');
      header.className = 'schedule-day-header';
      header.textContent = day;
      calendar.appendChild(header);
    });

    const weekDisplay = document.getElementById('weekDisplay');
    const startDate = new Date(currentWeekStart);
    const endDate = new Date(currentWeekStart);
    endDate.setDate(endDate.getDate() + 6);
    weekDisplay.textContent = `${startDate.toLocaleDateString('vi-VN', { day: 'numeric', month: 'long', year: 'numeric' })} - ${endDate.toLocaleDateString('vi-VN', { day: 'numeric', month: 'long', year: 'numeric' })}`;

    const shifts = await getMyShifts(startDate.toISOString().split('T')[0]);
    const weekShifts = shifts.filter(shift => {
      const shiftDate = new Date(shift.date);
      return shiftDate >= startDate && shiftDate <= endDate;
    });

    for (let i = 0; i < 7; i++) {
      const date = new Date(currentWeekStart);
      date.setDate(date.getDate() + i);
      const cell = document.createElement('div');
      cell.className = 'schedule-day-cell';
      const dayNumber = document.createElement('div');
      dayNumber.className = 'schedule-day-number';
      dayNumber.textContent = date.getDate();
      cell.appendChild(dayNumber);

      const dayShifts = weekShifts.filter(shift => {
        const shiftDate = new Date(shift.date);
        return shiftDate.toDateString() === date.toDateString();
      });

      if (dayShifts.length > 0) {
        const shiftsContainer = document.createElement('div');
        shiftsContainer.className = 'schedule-shifts-container';
        dayShifts.forEach(shift => {
          const shiftGroup = document.createElement('div');
          shiftGroup.className = 'schedule-shift-group';
          const shiftHeader = document.createElement('div');
          shiftHeader.className = 'schedule-shift-header';
          shiftHeader.textContent = shift.shift === 'FULL_DAY' ? 'CẢ NGÀY' :
                                   shift.shift === 'MORNING' ? 'SÁNG' :
                                   shift.shift === 'AFTERNOON' ? 'CHIỀU' :
                                   shift.shift === 'EVENING' ? 'TỐI' : shift.shift;
          const employeeCard = document.createElement('div');
          employeeCard.className = 'schedule-employee-card';
          const employeeInfo = document.createElement('div');
          employeeInfo.className = 'schedule-employee-info';
          const employeeName = document.createElement('div');
          employeeName.className = 'schedule-employee-name';
          employeeName.textContent = `Ca: ${shift.startTime} - ${shift.endTime} (${shift.note || 'Không có ghi chú'})`;
          employeeInfo.appendChild(employeeName);
          employeeCard.appendChild(employeeInfo);
          shiftGroup.appendChild(shiftHeader);
          shiftGroup.appendChild(employeeCard);
          shiftsContainer.appendChild(shiftGroup);
        });
        cell.appendChild(shiftsContainer);
      }
      calendar.appendChild(cell);
    }
  }

  async function getMyShifts(date) {
    try {
      const response = await fetch(`${API_BASE_URL}/shifts/my-work-schedule?date=${date}`, {
        method: 'GET',
        headers: {
          'Authorization': 'Bearer ' + getToken()
        }
      });
      const data = await response.json();
      if (response.ok) {
        return data.result || [];
      } else {
        throw new Error(data.message || 'Lỗi khi lấy lịch.');
      }
    } catch (error) {
      document.getElementById('errorMsg').innerText = error.message;
      if (error.message.includes('401')) {
        localStorage.removeItem('accessToken');
        window.location.href = 'login.html';
      }
      return [];
    }
  }

  function getToken() {
    return localStorage.getItem('accessToken') || '';
  }

  function prevWeek() {
    currentWeekStart.setDate(currentWeekStart.getDate() - 7);
    updateCalendar();
  }

  function nextWeek() {
    currentWeekStart.setDate(currentWeekStart.getDate() + 7);
    updateCalendar();
  }

  async function logout() {
    try {
      await fetch(`${API_BASE_URL}/auth/logout`, {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + getToken(),
          'Content-Type': 'application/json'
        }
      });
      localStorage.removeItem('accessToken');
      window.location.href = 'login.html';
    } catch (err) {
      localStorage.removeItem('accessToken');
      window.location.href = 'login.html';
    }
  }

  window.addEventListener('load', () => {
    if (!getToken()) {
      window.location.href = 'login.html';
    }
  });
</script>

</body>
</html>