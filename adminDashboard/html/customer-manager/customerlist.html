<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <title>FoodHub Admin - Quản lý khách hàng</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600&family=Nunito:wght@600;700;800&family=Pacifico&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/sidebar.css">
    <link rel="stylesheet" href="/css/staffList.css">

    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <!-- Sidebar Include -->
    <div id="sidebar-container"></div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Bar -->
        <div id="topbar-container"></div>

        <!-- Customer Management Content -->
        <div class="container-fluid p-4">
            <!-- Filter Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="fas fa-filter me-2"></i>Bộ lọc và Tìm kiếm</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="keyword" class="form-label fw-bold">Tìm kiếm</label>
                            <input type="text" id="keyword" class="form-control" placeholder="Nhập tên khách hàng...">
                        </div>
                        <div class="col-md-4">
                            <label for="statusFilter" class="form-label fw-bold">Trạng thái</label>
                            <select id="statusFilter" class="form-select">
                                <option value="">Tất cả trạng thái</option>
                                <option value="ACTIVE">Hoạt động</option>
                                <option value="INACTIVE">Không hoạt động</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="sortBy" class="form-label fw-bold">Sắp xếp</label>
                            <select id="sortBy" class="form-select">
                                <option value="username_asc">Tên A-Z</option>
                                <option value="username_desc">Tên Z-A</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customer Table Card -->
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-list me-2"></i>Danh sách khách hàng</h5>
                </div>
                <div class="card-body">
                    <!-- Loading Spinner -->
                    <div id="loadingSpinner" class="text-center py-5" style="display: none;">
                        <div class="spinner-border" style="width: 3rem; height: 3rem;" role="status">
                            <span class="visually-hidden">Đang tải...</span>
                        </div>
                        <p class="mt-3 text-muted">Đang tải dữ liệu...</p>
                    </div>

                    <!-- Customer Table -->
                    <div id="customerTable" class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead>
                                <tr>
                                    <th>Tên khách hàng</th>
                                    <th>Email</th>
                                    <th>Số điện thoại</th>
                                    <th style="width: 130px;">Trạng thái</th>
                                    <th style="width: 200px;">Thao tác</th>
                                </tr>
                            </thead>
                            <tbody id="customerTableBody">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Empty State -->
                    <div id="emptyState" class="empty-state" style="display: none;">
                        <i class="fas fa-users"></i>
                        <h5>Không có khách hàng nào</h5>
                        <p class="text-muted">Thử thay đổi bộ lọc để xem thêm khách hàng</p>
                    </div>
                </div>
            </div>

            <!-- Pagination -->
            <nav class="mt-4">
                <ul class="pagination justify-content-center" id="pagination"></ul>
            </nav>
        </div>
    </div>
<div class="modal fade" id="orderHistoryModal" tabindex="-1" aria-labelledby="orderHistoryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="orderHistoryModalLabel">
                    <i class="fas fa-history me-2"></i>Lịch sử đặt hàng
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Loading Spinner -->
                <div id="orderLoadingSpinner" class="text-center py-5" style="display: none;">
                    <div class="spinner-border" style="width: 3rem; height: 3rem;" role="status">
                        <span class="visually-hidden">Đang tải...</span>
                    </div>
                    <p class="mt-3 text-muted">Đang tải lịch sử đặt hàng...</p>
                </div>

                <!-- Order History Content -->
                <div id="orderHistoryContent">
                    <!-- Customer Info -->
                    <div class="customer-info mb-4" id="customerInfo" style="display: none;">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6 class="text-muted mb-2">Thông tin khách hàng</h6>
                                        <p class="mb-1"><strong>Tên:</strong> <span id="customerName"></span></p>
                                        <p class="mb-0"><strong>Email:</strong> <span id="customerEmail"></span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="text-muted mb-2">Thống kê</h6>
                                        <p class="mb-1"><strong>Tổng đơn hàng:</strong> <span id="totalOrders"></span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Orders List -->
                    <div id="ordersList">
                        <!-- Orders will be loaded here -->
                    </div>

                    <!-- Empty State -->
                    <div id="emptyOrderState" class="empty-state" style="display: none;">
                        <i class="fas fa-shopping-cart"></i>
                        <h5>Chưa có đơn hàng nào</h5>
                        <p class="text-muted">Khách hàng này chưa có đơn hàng nào</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JS -->
    <script src="/js/fetch-api.js"></script>
    <script src="/adminDashboard/js/sidebar.js"></script>
     <script src="/adminDashboard/js/topbar.js"></script>
    <script>
        async function loadSidebar() {
            try {
                const response = await fetch('/adminDashboard/components/sidebar.html');
                if (!response.ok) throw new Error('Không thể tải sidebar');
                const sidebarHtml = await response.text();
                document.getElementById('sidebar-container').innerHTML = sidebarHtml;
                setActiveNavLink(); // Gọi lại sau khi sidebar tải
            } catch (error) {
                console.error('Lỗi khi tải sidebar:', error);
                showNotification('Lỗi tải sidebar!', 'error');
                document.getElementById('sidebar-container').innerHTML = '<p>Lỗi khi tải sidebar!</p>';
            }
        }

        let currentPage = 0;
        const pageSize = 10;

        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'block';
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('customerTableBody').innerHTML = '';
        }

        function showError(message) {
            document.getElementById('customerTableBody').innerHTML = `
                <tr>
                    <td colspan="5" class="text-center py-4">
                        <i class="fas fa-exclamation-triangle text-warning fa-2x mb-2"></i>
                        <div>${message}</div>
                    </td>
                </tr>
            `;
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} alert-dismissible fade show notification`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 5000);
        }

        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
        }

        async function fetchCustomers() {
            showLoading();
            const keyword = document.getElementById('keyword').value.trim();
            const statusFilter = document.getElementById('statusFilter').value;
            const sortValue = document.getElementById('sortBy').value;

            let sortBy = 'username';
            let sortDirection = 'asc';
            if (sortValue) {
                const parts = sortValue.split('_');
                sortBy = parts[0];
                sortDirection = parts[1] || 'asc';
            }

            const params = new URLSearchParams({
                page: currentPage,
                size: pageSize,
                sortDirection: sortDirection
            });
            
            if (keyword) params.append('keyword', keyword);
            if (statusFilter) params.append('status', statusFilter);

            try {
                const response = await apiFetch(`/users/customers?${params.toString()}`, { method: 'GET' });
                console.log('API Response:', response); // Debug
                hideLoading();

                if (!response) {
                    throw new Error('Phản hồi API không hợp lệ: Không có dữ liệu');
                }

                if (response.code === 0) {
                    const data = response.result;
                    if (!data || !data.content) {
                        throw new Error('Dữ liệu không hợp lệ: content không tồn tại');
                    }
                    renderCustomerTable(data.content);
                    renderPagination(data.totalPages, data.number);
                } else {
                    const errorMessage = response.message || `Lỗi từ API: Code ${response.code}`;
                    showNotification(errorMessage, 'error');
                    showError(errorMessage);
                }
            } catch (error) {
                hideLoading();
                const errorMessage = error.message || 'Có lỗi xảy ra khi tải dữ liệu! Vui lòng kiểm tra backend.';
                showNotification(errorMessage, 'error');
                showError(errorMessage);
            }
        }

        function renderCustomerTable(items) {
    const tbody = document.getElementById('customerTableBody');

    if (!items || items.length === 0) {
        document.getElementById('emptyState').style.display = 'block';
        tbody.innerHTML = '';
        return;
    }

    document.getElementById('emptyState').style.display = 'none';
    tbody.innerHTML = '';

    items.forEach(item => {
        const isActive = item.status === 'ACTIVE' || !item.status;
        const statusClass = isActive ? 'status-active' : 'status-inactive';
        const statusText = isActive ? 'Hoạt động' : 'Không hoạt động';
        
        const actionButton = item.id ? (
            isActive ?
            `<button class="btn btn-outline-danger btn-sm" onclick="deactivateCustomer(${item.id})" title="Vô hiệu hóa">
                 <i class="fas fa-trash"></i>
               </button>` :
            `<button class="btn btn-outline-success btn-sm" onclick="restoreCustomer(${item.id})" title="Kích hoạt">
                 <i class="fas fa-undo"></i>
               </button>`
        ) : (
            isActive ?
            `<button class="btn btn-outline-danger btn-sm" disabled title="Vô hiệu hóa">
                 <i class="fas fa-trash"></i>
               </button>` :
            `<button class="btn btn-outline-success btn-sm" disabled title="Kích hoạt">
                 <i class="fas fa-undo"></i>
               </button>`
        );

        const editButton = item.id ?
            `<button class="btn btn-outline-primary btn-sm me-1" onclick="editCustomer(${item.id})" title="Chỉnh sửa">
             <i class="fas fa-edit"></i>
           </button>` :
            `<button class="btn btn-outline-primary btn-sm me-1" disabled title="Chỉnh sửa">
             <i class="fas fa-edit"></i>
           </button>`;

        const viewHistoryButton = item.id ?
            `<button class="btn btn-outline-info btn-sm me-1" onclick="viewOrderHistory(${item.id}, '${item.username}', '${item.email}')" title="Xem lịch sử đặt hàng">
             <i class="fas fa-eye"></i>
           </button>` :
            `<button class="btn btn-outline-info btn-sm me-1" disabled title="Xem lịch sử đặt hàng">
             <i class="fas fa-eye"></i>
           </button>`;

        const row = `
            <tr>
                <td>
                    <div class="fw-bold">${item.username || 'N/A'}</div>
                </td>
                <td>
                    <div class="text-muted">${item.email || 'N/A'}</div>
                </td>
                <td>
                    <div>${item.phone || 'Chưa có'}</div>
                </td>
                <td>
                    <span class="status-badge ${statusClass}">${statusText}</span>
                </td>
                <td>
                    <div class="action-buttons">
                        ${viewHistoryButton}
                        ${editButton}
                        ${actionButton}
                    </div>
                </td>
            </tr>
        `;
        tbody.insertAdjacentHTML('beforeend', row);
    });
}

        function renderPagination(totalPages, currentPageIndex) {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            if (!totalPages || totalPages <= 1) return;

            const prevDisabled = currentPageIndex === 0 ? 'disabled' : '';
            pagination.innerHTML += `
                <li class="page-item ${prevDisabled}">
                    <a class="page-link" href="#" onclick="changePage(${currentPageIndex - 1}); return false;">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>`;

            const startPage = Math.max(0, currentPageIndex - 2);
            const endPage = Math.min(totalPages - 1, currentPageIndex + 2);

            if (startPage > 0) {
                pagination.innerHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="changePage(0); return false;">1</a>
                    </li>`;
                if (startPage > 1) {
                    pagination.innerHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                const active = currentPageIndex === i ? 'active' : '';
                pagination.innerHTML += `
                    <li class="page-item ${active}">
                        <a class="page-link" href="#" onclick="changePage(${i}); return false;">${i + 1}</a>
                    </li>`;
            }

            if (endPage < totalPages - 1) {
                if (endPage < totalPages - 2) {
                    pagination.innerHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                }
                pagination.innerHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="changePage(${totalPages - 1}); return false;">${totalPages}</a>
                    </li>`;
            }

            const nextDisabled = currentPageIndex === totalPages - 1 ? 'disabled' : '';
            pagination.innerHTML += `
                <li class="page-item ${nextDisabled}">
                    <a class="page-link" href="#" onclick="changePage(${currentPageIndex + 1}); return false;">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>`;
        }

        function changePage(page) {
            if (page < 0) return;
            currentPage = page;
            fetchCustomers();
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        async function deactivateCustomer(id) {
            if (!id) {
                showNotification('Không tìm thấy ID khách hàng!', 'error');
                return;
            }
            if (!confirm('Bạn có chắc chắn muốn vô hiệu hóa khách hàng này?')) return;

            try {
                const response = await apiFetch(`/users/employees/${id}`, { method: 'DELETE' });
                if (response.code === 1000) {
                    showNotification('Vô hiệu hóa khách hàng thành công!', 'success');
                    fetchCustomers();
                } else {
                    throw new Error(response.message || 'Lỗi khi vô hiệu hóa khách hàng');
                }
            } catch (error) {
                const errorMessage = error.message || 'Có lỗi xảy ra khi vô hiệu hóa khách hàng!';
                showNotification(errorMessage, 'error');
            }
        }

        async function restoreCustomer(id) {
            if (!id) {
                showNotification('Không tìm thấy ID khách hàng!', 'error');
                return;
            }
            if (!confirm('Bạn có chắc chắn muốn khôi phục khách hàng này?')) return;

            try {
                const response = await apiFetch(`/users/employees/${id}/restore`, { method: 'PUT' });
                if (response.code === 1000) {
                    showNotification('Khôi phục khách hàng thành công!', 'success');
                    fetchCustomers();
                } else {
                    throw new Error(response.message || 'Lỗi khi khôi phục khách hàng');
                }
            } catch (error) {
                showNotification(error.message || 'Có lỗi xảy ra khi khôi phục khách hàng!', 'error');
            }
        }

        function editCustomer(id) {
            if (!id) {
                showNotification('Không tìm thấy ID khách hàng!', 'error');
                return;
            }
            window.location.href = `edit-customer.html?id=${id}`;
        }

        // Debounce function để tránh gọi API quá nhiều lần khi gõ
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
async function viewOrderHistory(userId, username, email) {
    if (!userId) {
        showNotification('Không tìm thấy ID khách hàng!', 'error');
        return;
    }

    // Hiển thị modal
    const modal = new bootstrap.Modal(document.getElementById('orderHistoryModal'));
    modal.show();

    // Cập nhật thông tin khách hàng
    document.getElementById('customerName').textContent = username || 'N/A';
    document.getElementById('customerEmail').textContent = email || 'N/A';

    // Load lịch sử đặt hàng
    await loadOrderHistory(userId);
}

// Function để load lịch sử đặt hàng từ API
async function loadOrderHistory(userId) {
    const loadingSpinner = document.getElementById('orderLoadingSpinner');
    const ordersList = document.getElementById('ordersList');
    const emptyOrderState = document.getElementById('emptyOrderState');
    const customerInfo = document.getElementById('customerInfo');

    // Hiển thị loading
    loadingSpinner.style.display = 'block';
    ordersList.innerHTML = '';
    emptyOrderState.style.display = 'none';
    customerInfo.style.display = 'none';

    try {
        const response = await apiFetch(`/orders/user/${userId}`, { method: 'GET' });
        
        if (response && response.code === 0) {
            const orders = response.result.content || [];
            
            if (orders.length > 0) {
                renderOrderHistory(orders);
                updateCustomerStats(orders);
                customerInfo.style.display = 'block';
            } else {
                emptyOrderState.style.display = 'block';
            }
        } else {
            throw new Error(response?.message || 'Lỗi khi tải lịch sử đặt hàng');
        }
    } catch (error) {
        showNotification(error.message || 'Có lỗi xảy ra khi tải lịch sử đặt hàng!', 'error');
        emptyOrderState.style.display = 'block';
    } finally {
        loadingSpinner.style.display = 'none';
    }
}

// Function để render danh sách đơn hàng
function renderOrderHistory(orders) {
    const ordersList = document.getElementById('ordersList');
    
    ordersList.innerHTML = orders.map(order => {
        const createdDate = new Date(order.createdAt).toLocaleDateString('vi-VN', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
        });

        const statusClass = getOrderStatusClass(order.status);
        const orderTypeText = getOrderTypeText(order.orderType);

        return `
            <div class="card mb-3 order-card">
                <div class="card-header">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h6 class="mb-0">
                                <i class="fas fa-receipt me-2"></i>
                                Đơn hàng #${order.id}
                            </h6>
                            <small class="text-muted">${createdDate}</small>
                        </div>
                        <div class="col-md-6 text-md-end">
                             <span class="badge ${statusClass} me-2">${getOrderStatusText(order.status)}</span>
                            <span class="badge bg-secondary">${orderTypeText}</span>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h6 class="mb-2">Món ăn đã đặt:</h6>
                            <ul class="list-unstyled mb-0">
                                ${order.orderItems.map(item => `
                                    <li class="d-flex justify-content-between align-items-center mb-2">
                                        <div>
                                            <strong>${item.menuItemName}</strong>
                                            <span class="text-muted"> x${item.quantity}</span>
                                           <span class="badge ${getOrderStatusClass(item.status)} ms-2">${getOrderStatusText(item.status) || 'N/A'}</span>
                                            <div class="text-muted small">Đơn giá: ${formatCurrency(item.price)}</div>
                                        </div>
                                        <span class="fw-bold">Tổng: ${formatCurrency(item.price * item.quantity)}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        <div class="col-md-4">
                            <div class="order-summary">
                                ${order.tableNumber ? `<p class="mb-1"><strong>Bàn:</strong> ${order.tableNumber}</p>` : ''}
                                <p class="mb-1"><strong>Thanh toán:</strong> ${getPaymentMethodText(order.payment?.paymentMethod)}</p>
                                <p class="mb-1"><strong>Trạng thái TT:</strong> 
                                    <span class="badge ${getPaymentStatusClass(order.payment?.status)}">${order.payment?.status || 'N/A'}</span>
                                </p>
                                <hr>
                                <h5 class="mb-0 text-primary">
                                    <strong>Tổng: ${formatCurrency(order.totalAmount)}</strong>
                                </h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}
function getOrderStatusText(status) {
    switch(status) {
        case 'PENDING': return 'Đang chờ';
        case 'CONFIRMED': return 'Đã xác nhận';
        case 'PREPARING': return 'Đang chuẩn bị';
        case 'COMPLETED': return 'Hoàn thành';
        case 'READY': return 'Sẵn sàng';
        case 'CANCELLED': return 'Đã hủy';
        default: return status || 'N/A';
    }
}

// Function để cập nhật thống kê khách hàng
function updateCustomerStats(orders) {
    const totalOrders = orders.length;
    document.getElementById('totalOrders').textContent = totalOrders;
}

// Helper functions
function getOrderStatusClass(status) {
    switch(status) {
        case 'COMPLETED': 
        case 'READY': return 'bg-success';
        case 'PENDING': 
        case 'CONFIRMED': 
        case 'PREPARING': return 'bg-warning';
        case 'CANCELLED': return 'bg-danger';
        default: return 'bg-secondary';
    }
}

function getPaymentStatusClass(status) {
    switch(status) {
        case 'PAID': return 'bg-success';
        case 'PENDING': 
        case 'UNPAID': return 'bg-warning';
        case 'CANCELLED': 
        case 'FAILED': 
        case 'REFUNDED': return 'bg-danger';
        default: return 'bg-secondary';
    }
}

function getOrderTypeText(orderType) {
    switch(orderType) {
        case 'DINE_IN': return 'Tại chỗ';
        case 'TAKEAWAY': return 'Mang về';
        case 'DELIVERY': return 'Giao hàng';
        default: return orderType || 'N/A';
    }
}

function getPaymentMethodText(paymentMethod) {
    switch(paymentMethod) {
        case 'CASH': return 'Tiền mặt';
        case 'BANKING': return 'Banking';
        default: return paymentMethod || 'N/A';
    }
}

function formatCurrency(amount) {
    return new Intl.NumberFormat('vi-VN', {
        style: 'currency',
        currency: 'VND'
    }).format(amount || 0);
}
        // Hàm xử lý khi filter/sort thay đổi
        function handleFilterChange() {
            currentPage = 0; // Reset về trang đầu khi lọc
            fetchCustomers();
        }

        // Debounced version cho input search
        const debouncedHandleFilterChange = debounce(handleFilterChange, 500);

        // Gắn sự kiện cho các elements
        document.addEventListener('DOMContentLoaded', () => {
            loadTopbar();
            loadSidebar();
            fetchCustomers();

            // Sự kiện cho ô tìm kiếm (debounce 500ms)
            const keywordInput = document.getElementById('keyword');
            if (keywordInput) {
                keywordInput.addEventListener('input', debouncedHandleFilterChange);
            }

            // Sự kiện cho dropdown trạng thái (thực hiện ngay lập tức)
            const statusFilter = document.getElementById('statusFilter');
            if (statusFilter) {
                statusFilter.addEventListener('change', handleFilterChange);
            }

            // Sự kiện cho dropdown sắp xếp (thực hiện ngay lập tức)
            const sortBy = document.getElementById('sortBy');
            if (sortBy) {
                sortBy.addEventListener('change', handleFilterChange);
            }
        });
    </script>
</body>
</html>